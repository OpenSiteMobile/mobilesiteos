msos.version=new msos.set_version(17,4,6),msos.console.info("msos/core -> start, "+msos.version),msos.console.time("core"),msos.escape_html=function(e){"use strict";return e?jQuery("<div></div>").text(e).html():""},msos.absolute_url=function(e){"use strict";var s=document.createElement("div");return s.innerHTML='<a href="'+msos.escape_html(e)+'">x</a>',s.firstChild.href},msos.valid_jq_node=function(e,s){"use strict";var o="msos.valid_jq_node -> input is not a ";if(msos.in_dom_jq_node(e)){if(e[0].tagName.toLowerCase()===s)return!0;msos.console.error(o+"valid jQuery node: ",e)}else msos.console.error(o+"node of type: "+s);return!1},msos.in_dom_jq_node=function(e){"use strict";return e&&e.length&&e[0].parentNode?!0:(e=null,!1)},msos.byid=function(e,s){"use strict";var o="msos.byid -> ",n=null,r=null;return n=s?s:window.document,"string"!=typeof e?(msos.console.error(o+"input not an id string!"),null):(r=jQuery("#"+e,n)[0],_.isElement(r)?r:(msos.console.warn(o+"na: "+e),null))},msos.zero_pad=function(e,s,o){"use strict";for(var n=e.toString();n.length<s;)n=o?"0"+n:n+"0";return n},msos.array_segments=function(e,s){"use strict";var o=0,n=e.length,r=[];for(o=0;n>o;o+=s)r.push(e.slice(o,o+s));return r},msos.run_console_forced=function(e){"use strict";var s=msos.array_segments(e,25),o=0;for(o=0;o<s.length;o+=1)alert(s[o].join("\n"))},msos.run_onresize=function(){"use strict";var e="msos.run_onresize -> ",s=msos.config.view_port.width,o=0;for(msos.console.debug(e+"start."),msos.get_viewport(window),o=0;o<msos.onresize_functions.length;o+=1)msos.onresize_functions[o]();msos.console.debug(e+"done, orig. w: "+s+", new w: "+msos.config.view_port.width+", for: "+o+" functions.")},msos.run_onorientationchange=function(){"use strict";var e="msos.run_onorientationchange -> ",s=msos.config.view_port.width,o=msos.config.view_orientation,n=0;if(msos.console.debug(e+"start, new: "+window.orientation+", pre: "+o.numeric),window.orientation===o.numeric)return void msos.console.debug(e+"done, no change.");for(msos.browser_orientation(),msos.get_viewport(window),n=0;n<msos.onorientationchange_functions.length;n+=1)msos.onorientationchange_functions[n]();msos.console.debug(e+"done, orig. w: "+s+", new w: "+msos.config.view_port.width+", for: "+n+" functions.")},msos.gen_select_menu=function(e,s,o){"use strict";function n(e,s){var i,u,m="",a="";for(m in s)s.hasOwnProperty(m)&&(u=s[m],"object"==typeof u?(m.replace("_"," "),i=jQuery('<optgroup label="'+m+'">'),n(i,u),e.append(i)):"string"==typeof u?(a=jQuery.trim(s[m]),m===o?e.append(new Option(a,m,!1,!0)):e.append(new Option(a,m)),t.push(m)):msos.console.error(r+" -> oops: "+m))}var r="msos.gen_select_menu",t=[],i=[];if(msos.config.verbose?msos.console.debug(r+" -> start: ",s):msos.console.debug(r+" -> start, id: "+(e.attr("id")||"na")),msos.valid_jq_node(e,"select")){if(e.empty(),o=o?o.replace(/\W/g,"_"):"",!(_.size(s)>0))return void msos.console.error(r+" -> done, no options passed in!");n(e,s),i=_.uniq(t),t.length!==i.length&&msos.console.error(r+" -> duplicate key!"),msos.console.debug(r+" -> done!")}},msos.provide=function(e){"use strict";var s="msos.provide -> ",o=e.replace(/\./g,"_");msos.registered_modules[o]?msos.console.warn(s+"already registered: "+e):msos.registered_modules[o]=!0,msos.console.debug(s+"executing: "+e)},msos.require=function(e,s){"use strict";var o="msos.require -> ",n="",r=e.split("."),t=r[0],i=null,u=null,m=null,a="";if(!/^[0-9a-zA-Z.\-]+$/.test(e))return void msos.console.error(o+"name not allowed: "+e);if(n=e.replace(/\./g,"_"),"boolean"==typeof msos.registered_modules[n])return void(msos.registered_modules[n]===!0&&_.isFunction(s)&&s());if(msos.registered_modules[n]=!1,i=function(){msos.registered_modules[n]?msos.console.debug(o+"success: "+e):msos.console.error(o+"failed: "+e)},msos.registered_folders[t]||(msos.console.debug(o+"auto resolving module base: "+t),msos.registered_folders[t]=msos.resource_url(t,"")),msos.gen_namespace(e),"msos"===r[0]&&"i18n"===r[1]&&r.length>2){if(msos.config.verbose&&msos.console.debug(o+"i18n request for: "+e),"boolean"==typeof msos.registered_modules.msos_i18n)return;r.splice(2),e=r.join("."),n=r.join("_"),msos.registered_modules.msos_i18n=!1}r.shift(),a=msos.registered_folders[t]+r.join("/")+".js",msos.require_queue+=1,msos.config.verbose&&msos.console.debug(o+"request for module: "+a+", queue: "+msos.require_queue),u=function(){msos.console.debug(o+"found: "+e+", queue: "+msos.require_queue),msos.registered_files.ajax[e]=a,_.isFunction(s)&&s()},m=function(){msos.console.debug(o+"completed: "+e+", queue: "+msos.require_queue),setTimeout(i,100),msos.require_queue-=1},msos.ajax_request(a,"script",u,m)},msos.template=function(e,s){"use strict";var o="msos.template -> ",n=e.replace(/\./g,"_"),r=e.split("."),t=r[0],i=null,u=null,m=null,a="";return/^[0-9a-zA-Z.\-]+$/.test(e)?(i=msos.gen_namespace(e),"boolean"==typeof msos.registered_templates[n]?void(msos.registered_templates[n]===!0&&_.isFunction(s)&&s(i)):(msos.registered_templates[n]=!1,msos.registered_folders[t]||(msos.console.debug(o+"auto resolving template base: "+t),msos.registered_folders[t]=msos.resource_url(t,"")),r.shift(),a=msos.registered_folders[t]+r.join("/")+".html",msos.require_queue+=1,msos.config.verbose&&msos.console.debug(o+"request for template: "+a+", queue: "+msos.require_queue),u=function(r){"string"==typeof r&&r.length>0?(i.text=r,i.name=n,msos.registered_templates[n]=!0,msos.console.debug(o+"found: "+e+", queue: "+msos.require_queue),_.isFunction(s)&&s(i)):(i.text="",msos.console.error(o+"failed, no data: "+e+", queue: "+msos.require_queue))},m=function(){msos.console.debug(o+"completed: "+e+", queue: "+msos.require_queue),msos.require_queue-=1},void msos.ajax_request(a,"html",u,m))):void msos.console.error(o+"name not allowed: "+e)},msos.ajax_request=function(e,s,o,n){"use strict";var r="msos.ajax_request -> ",t=msos.generate_url_name(e),i=msos.new_time(),u=function(e,s,n){if("string"==typeof e&&e.length>0){var u=msos.new_time(),m=(u-i)/1e3,a=8*e.length,c=Math.round(a/m),d=parseInt(c/1024,10);msos.ajax_loading_kbps[t]=d}msos.config.verbose&&msos.console.debug(r+"status: "+s+", data length: "+(e&&e.length||0)),_.isFunction(o)&&o(e,s,n)},m=function(e,s){var o=e.status+", status: "+s;msos.config.verbose&&msos.console.debug(r+"completed: "+o),_.isFunction(n)&&n(e,s)};jQuery.ajax({url:e,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:s,cache:msos.config.cache,success:u,error:msos.ajax_error,complete:m})},msos.ajax_error=function(e,s,o){"use strict";var n=s+": "+o,r="",t={};switch(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle&&(t=msos.i18n.common.bundle),e.status){case 200:r=t.internal||"Internal error";break;case 404:r=t.input||"Input error";break;case 407:r=t.authentication||"Authentication error";break;case 500:r=t.server||"Server error";break;case 504:r=t.timeout||"Timeout error";break;default:r=t.unknown||"Unknown error"}r+=" ("+(e.status||"no status")+")",msos.notify.error(o,r),msos.require_queue>0&&(r+=", ref. req. queue "+msos.require_queue),msos.i18n_queue>0&&(r+=", ref. i18n queue "+msos.i18n_queue),r="msos.ajax_error -> failed: "+n+", xhr: "+r,msos.config.verbose?msos.console.error(r,e):msos.console.error(r)},msos.hide_mobile_url=function(){"use strict";var e,s="msos.hide_mobile_url -> ";location.hash?msos.console.debug(s+"skipped, for location.hash"):(window.scrollTo(0,1),e=window.pageYOffset||"CSS1Compat"===window.document.compatMode&&window.document.documentElement.scrollTop||window.document.body.scrollTop||0,msos.console.debug(s+"called, scrollTop: "+e),setTimeout(function(){window.scrollTo(0,1===e?0:1)},1))},msos.notify={container:jQuery("<div id='notify_container'></div>"),add:function(){"use strict";var e=msos.notify.container;jQuery("body").append(e),e.position({of:window,my:"center top+60",at:"center top",collision:"none"}),e.css("position","fixed")},queue:[],current:null,clear_current:function(){"use strict";var e=msos.notify;null!==e.current&&"warning"!==e.current.type&&"error"!==e.current.type&&(msos.console.debug("msos.notify.clear_current -> called, on type: "+e.current.type),e.current.fade_out())},clear:function(){"use strict";var e=msos.notify,s=0;for(msos.console.debug("msos.notify.clear -> called, for queue: "+e.queue.length),e.clear_current(),s=0;s<e.queue.length;s+=1)"warning"!==e.queue[s].type&&"error"!==e.queue[s].type&&clearTimeout(e.queue[s].auto_delay)},run:function(){"use strict";var e="msos.notify.run -> ",s=msos.notify;s.current=s.queue.shift()||null,_.isObject(s.current)&&(msos.console.debug(e+"prepend, type: "+s.current.type),s.container.prepend(s.current.note_el),s.current.auto_delay=setTimeout(s.current.fade_out,s.current.delay))},base:function(e,s,o,n,r){"use strict";var t="msos.notify.base -> ",i=msos.notify,u={type:e,delay:r||4e3,auto_delay:0,icon_el:null,butt_el:jQuery("<button class='btn btn-danger btn-small fa fa-times'></button>"),note_el:jQuery("<div class='notify'></div>"),disp_el:jQuery("<div class='notify_display'></div>"),titl_el:jQuery("<div class='notify_title'></div>"),msg_el:jQuery("<div class='notify_msg'></div>")};return msos.console.debug(t+"start, type: "+e),u.disp_el.append(u.butt_el),n&&(u.icon_el=jQuery(n),u.note_el.append(u.icon_el)),o&&(u.titl_el.append(document.createTextNode(o)),u.disp_el.append(u.titl_el)),s&&(u.msg_el.append(document.createTextNode(s)),u.disp_el.append(u.msg_el)),u.note_el.append(u.disp_el),u.fade_out=function(){0===u.auto_delay?i.queue.pop():(clearTimeout(u.auto_delay),u.note_el.fadeOut("slow",function(){msos.console.debug(t+"fade_out, type: "+e),u.note_el.remove(),i.run()}))},u.butt_el.on("click",u.fade_out),i.queue.push(u),null===i.current&&i.run(),msos.console.debug(t+"done!"),u},info:function(e,s){"use strict";var o=new msos.notify.base("info",e,s,'<i class="fa fa-info-circle fa-2x info">');return o},warning:function(e,s){"use strict";var o=new msos.notify.base("warning",e,s,'<i class="fa fa-warning fa-2x warning">',6e3);return o},error:function(e,s){"use strict";var o=new msos.notify.base("error",e,s,'<i class="fa fa-ban fa-2x error">',8e3);return o},success:function(e,s){"use strict";var o=new msos.notify.base("success",e,s,'<i class="fa fa-check-circle fa-2x success">');return o},loading:function(e,s){"use strict";var o=new msos.notify.base("loading",e,s,'<i class="fa fa-spinner fa-spin fa-2x loading">',1e4);return o}},window.onerror=function(e,s,o,n,r){"use strict";var t="JavaScript Error!";return msos.console.error("window.onerror -> fired, line: "+o+", url: "+s+", error: "+e,r),msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle&&(t=msos.i18n.common.bundle.error||t),msos.notify.error(e,t),!0},msos.check_deferred_scripts=function(){"use strict";var e="msos.check_deferred_scripts -> ",s=!0,o=msos.registered_files.js,n="",r="";msos.require_deferred+=1;for(r in o)o.hasOwnProperty(r)&&(n=o[r].getAttribute("defer")||!1,n&&"loaded"!==o[r].msos_load_state&&(s=!1,msos.console.debug(e+"still loading: "+r+", attemp: "+msos.require_deferred)));msos.require_deferred>9?(msos.config.verbose&&prompt("A deferred script failed to load. Click OK to continue."),setTimeout(function(){location.reload()},100)):s?(msos.config.mobile&&msos.hide_mobile_url(),msos.notify.add(),msos.run_intial(),msos.run_onload()):setTimeout(msos.check_deferred_scripts,100)},msos.check_resources=function(){"use strict";var e,s,o="msos.check_resources -> ",n="",r=0,t=0,i=document.getElementsByTagName("script")||[],u={modules:"module(s)",files:"file(s)",load_error:"Loading Error!",load_failed:"failed to load."},m="",a="";for(n in msos.registered_modules)msos.registered_modules.hasOwnProperty(n)&&(msos.registered_modules[n]||(msos.console.error(o+"module failed to load: "+n.replace(/_/g,".")),r+=1));for(s=0;s<i.length;s+=1)!i[s].readyState||"loaded"===i[s].readyState&&"complete"===i[s].readyState||(e=i[s].getAttribute("src")||"",e&&(msos.console.error(o+"file failed to load: "+e),t+=1));if(r>0||t>0){if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle)for(m in u)u.hasOwnProperty(m)&&msos.i18n.common.bundle[m]&&(u[m]=msos.i18n.common.bundle[m]);r>0&&(a+=r+" "+u.modules,a+=t>0?", ":""),t>0&&(a+=t+" "+u.files),a+=" "+u.load_failed,msos.notify.error(a,u.load_error)}},msos.set_bandwidth=function(){"use strict";var e="msos.set_bandwidth -> ",s="",o=msos.config,n=o.storage.site_ajax,r=o.storage.site_bdwd,t=msos.ajax_loading_kbps,i=msos.basil.get(n.name)||{},u="",m=!1,a=0,c=0,d=0;o.clear_storage&&(s+=", cleared storage (as new user)"),o.verbose?(s+=", request ajax bandwidth: ",msos.console.debug(e+"start"+s,t)):(s+=".",msos.console.debug(e+"start"+s));for(u in t)t.hasOwnProperty(u)&&(i[u]=t[u],m=!0);if(m){msos.console.debug(e+"new value(s) added!");for(u in i)i.hasOwnProperty(u)&&(c+=parseInt(i[u],10),a+=1);d=c/a,n.value=i,msos.basil.set(n.name,n.value),n.set=!0}else msos.console.debug(e+"no new values"),d=r.value||10;r.value=parseInt(d,10),msos.basil.set(r.name,r.value),r.set=!0,msos.console.debug(e+"done, bandwidth: "+parseInt(d,10))},msos.connection=function(){"use strict";var e="msos.connection -> ",s=navigator.connection||{type:0,bandwidth:0,metered:!1},o=msos.config.connection,n="na",r=0,t=function(e,s,o){return o>s?e>=s&&o>=e:e>=o&&s>=this};msos.config.verbose&&msos.console.debug(e+"start, input: ",s),msos.config.storage.site_bdwd.set||msos.console.warn(e+"calc'd bandwidth not available yet!"),r=s.bandwidth&&!msos.var_is_empty(s.bandwidth)?s.bandwidth:msos.config.storage.site_bdwd.value||10,1===s.type&&(n="fast"),2===s.type&&(n="fast"),/wifi|ethernet/i.test(s.type)&&(n="fast"),(3===s.type||/2g$/i.test(s.type))&&(n="2g"),(4===s.type||/3g$/i.test(s.type))&&(n="3g"),/4g$/i.test(s.type)&&(n="4g"),"na"===n&&(n=t(r,1,50)?"slow":t(r,51,150)?"2g":t(r,151,600)?"3g":t(r,601,1e3)?"4g":"fast"),o.type=n,o.bandwidth=r,o.metered=!!s.metered,msos.config.verbose&&msos.console.debug(e+"done, output: ",o)},msos.set_window_onchange=function(){"use strict";var e="msos.set_window_onchange -> ";msos.console.debug(e+"start."),jQuery(window).on("resize",_.debounce(msos.run_onresize,250)),msos.config.orientation&&msos.config.orientation_change&&jQuery(window).on("orientationchange",_.debounce(msos.run_onorientationchange,100)),msos.console.debug(e+"done!")},msos.run_intial=function(){"use strict";var e="msos.run_intial -> ";msos.console.debug(e+"start."),msos.body=window.document.body||window.document.getElementsByTagName("body")[0],msos.head=msos.get_head(window),msos.html=window.document.getElementsByTagName("html")[0],msos.docl="BackCompat"===document.compatMode?window.document.body:window.document.documentElement,msos.browser_direction(),msos.console.debug(e+"done!")},msos.run_final=function(){"use strict";var e="msos.run_final";msos.console.debug(e+" -> start."),msos.run_function_array("onload_func_post"),msos.set_locale_storage(),msos.console.debug(e+" -> done!"),msos.config.console_forced&&msos.run_console_forced(msos.console.queue),msos.pyromane&&setTimeout(msos.pyromane.run,500),msos.run_onload_incr+=1},msos.run_onload_incr=1,msos.run_onload=function(){"use strict";var e,s="msos.run_onload ("+msos.run_onload_incr+") =====> ",o=msos.config,n=100,r=n/1e3,t=o.storage;if(0===msos.require_attempts)return msos.console.time("run_onload"),o.verbose?msos.console.debug(s+"start.",o):msos.console.debug(s+"start."),msos.run_function_array("onload_func_pre"),setTimeout(msos.run_onload,n),void(msos.require_attempts+=1);if(0===msos.require_queue&&msos.i18n&&!msos.i18n.done)return msos.i18n.module_add(),msos.i18n.done=!0,setTimeout(msos.run_onload,n),void(msos.require_attempts+=1);if(0===msos.require_queue&&0===msos.i18n_queue&&!t.site_bdwd.set)return msos.set_bandwidth(),msos.connection(),msos.set_window_onchange(),msos.basil.set(t.site_pref.name,t.site_pref.value),t.site_pref.set=!0,msos.basil.set(t.site_bdwd.name,t.site_bdwd.value),setTimeout(msos.run_onload,n),void(msos.require_attempts+=1);if(0===msos.require_queue&&0===msos.i18n_queue&&msos.onload_func_start.length>0)return msos.run_function_array("onload_func_start"),setTimeout(msos.run_onload,n),void(msos.require_attempts+=1);if(0===msos.require_queue&&0===msos.i18n_queue&&0===msos.pending_file_loads.length)msos.run_function_array("onload_functions"),msos.run_function_array("onload_func_done"),o.verbose?msos.console.debug(s+"done, modules and templates: ",msos.registered_modules,msos.registered_templates):msos.console.debug(s+"done!"),msos.require_attempts=0,msos.i18n&&(msos.i18n.done=!1),msos.console.timeEnd("run_onload"),setTimeout(msos.run_final,n);else{if(-1!==_.indexOf([10,20,40,80,100,100],msos.require_attempts))msos.console.warn(s+"waited: "+msos.require_attempts*r+" secs.");else if(msos.require_attempts>100)return e=function(){msos.console.error(s+"failed, module queue: "+msos.require_queue+", i18n queue: "+msos.i18n_queue+", pending file loading:",msos.pending_file_loads),msos.notify.warning(jQuery("title").text(),"Page Timed Out"),msos.check_resources(),msos.config.console_forced&&msos.run_console_forced(msos.console.queue)},void setTimeout(e,400);setTimeout(msos.run_onload,n),msos.require_attempts+=1}},jQuery(document).ready(msos.check_deferred_scripts),msos.registered_modules.msos=!0,msos.console.info("msos/core -> done, "+msos.version),msos.console.timeEnd("core");