!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(n){t=self}t.SparkMD5=e()}}(function(e){"use strict";function t(e,t,n,s,i,r){return t=S(S(t,e),S(s,r)),S(t<<i|t>>>32-i,n)}function n(e,n,s,i,r,o,a){return t(n&s|~n&i,e,n,r,o,a)}function s(e,n,s,i,r,o,a){return t(n&i|s&~i,e,n,r,o,a)}function i(e,n,s,i,r,o,a){return t(n^s^i,e,n,r,o,a)}function r(e,n,s,i,r,o,a){return t(s^(n|~i),e,n,r,o,a)}function o(e,t){var o=e[0],a=e[1],c=e[2],h=e[3];o=n(o,a,c,h,t[0],7,-680876936),h=n(h,o,a,c,t[1],12,-389564586),c=n(c,h,o,a,t[2],17,606105819),a=n(a,c,h,o,t[3],22,-1044525330),o=n(o,a,c,h,t[4],7,-176418897),h=n(h,o,a,c,t[5],12,1200080426),c=n(c,h,o,a,t[6],17,-1473231341),a=n(a,c,h,o,t[7],22,-45705983),o=n(o,a,c,h,t[8],7,1770035416),h=n(h,o,a,c,t[9],12,-1958414417),c=n(c,h,o,a,t[10],17,-42063),a=n(a,c,h,o,t[11],22,-1990404162),o=n(o,a,c,h,t[12],7,1804603682),h=n(h,o,a,c,t[13],12,-40341101),c=n(c,h,o,a,t[14],17,-1502002290),a=n(a,c,h,o,t[15],22,1236535329),o=s(o,a,c,h,t[1],5,-165796510),h=s(h,o,a,c,t[6],9,-1069501632),c=s(c,h,o,a,t[11],14,643717713),a=s(a,c,h,o,t[0],20,-373897302),o=s(o,a,c,h,t[5],5,-701558691),h=s(h,o,a,c,t[10],9,38016083),c=s(c,h,o,a,t[15],14,-660478335),a=s(a,c,h,o,t[4],20,-405537848),o=s(o,a,c,h,t[9],5,568446438),h=s(h,o,a,c,t[14],9,-1019803690),c=s(c,h,o,a,t[3],14,-187363961),a=s(a,c,h,o,t[8],20,1163531501),o=s(o,a,c,h,t[13],5,-1444681467),h=s(h,o,a,c,t[2],9,-51403784),c=s(c,h,o,a,t[7],14,1735328473),a=s(a,c,h,o,t[12],20,-1926607734),o=i(o,a,c,h,t[5],4,-378558),h=i(h,o,a,c,t[8],11,-2022574463),c=i(c,h,o,a,t[11],16,1839030562),a=i(a,c,h,o,t[14],23,-35309556),o=i(o,a,c,h,t[1],4,-1530992060),h=i(h,o,a,c,t[4],11,1272893353),c=i(c,h,o,a,t[7],16,-155497632),a=i(a,c,h,o,t[10],23,-1094730640),o=i(o,a,c,h,t[13],4,681279174),h=i(h,o,a,c,t[0],11,-358537222),c=i(c,h,o,a,t[3],16,-722521979),a=i(a,c,h,o,t[6],23,76029189),o=i(o,a,c,h,t[9],4,-640364487),h=i(h,o,a,c,t[12],11,-421815835),c=i(c,h,o,a,t[15],16,530742520),a=i(a,c,h,o,t[2],23,-995338651),o=r(o,a,c,h,t[0],6,-198630844),h=r(h,o,a,c,t[7],10,1126891415),c=r(c,h,o,a,t[14],15,-1416354905),a=r(a,c,h,o,t[5],21,-57434055),o=r(o,a,c,h,t[12],6,1700485571),h=r(h,o,a,c,t[3],10,-1894986606),c=r(c,h,o,a,t[10],15,-1051523),a=r(a,c,h,o,t[1],21,-2054922799),o=r(o,a,c,h,t[8],6,1873313359),h=r(h,o,a,c,t[15],10,-30611744),c=r(c,h,o,a,t[6],15,-1560198380),a=r(a,c,h,o,t[13],21,1309151649),o=r(o,a,c,h,t[4],6,-145523070),h=r(h,o,a,c,t[11],10,-1120210379),c=r(c,h,o,a,t[2],15,718787259),a=r(a,c,h,o,t[9],21,-343485551),e[0]=S(o,e[0]),e[1]=S(a,e[1]),e[2]=S(c,e[2]),e[3]=S(h,e[3])}function a(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function c(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function h(e){var t,n,s,i,r,c,h=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;h>=t;t+=64)o(l,a(e.substring(t-64,t)));for(e=e.substring(t-64),n=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(o(l,s),t=0;16>t;t+=1)s[t]=0;return i=8*h,i=i.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(i[2],16),c=parseInt(i[1],16)||0,s[14]=r,s[15]=c,o(l,s),l}function l(e){var t,n,s,i,r,a,h=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;h>=t;t+=64)o(l,c(e.subarray(t-64,t)));for(e=h>t-64?e.subarray(t-64):new Uint8Array(0),n=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)s[t>>2]|=e[t]<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(o(l,s),t=0;16>t;t+=1)s[t]=0;return i=8*h,i=i.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(i[2],16),a=parseInt(i[1],16)||0,s[14]=r,s[15]=a,o(l,s),l}function u(e){var t,n="";for(t=0;4>t;t+=1)n+=b[e>>8*t+4&15]+b[e>>8*t&15];return n}function d(e){var t;for(t=0;t<e.length;t+=1)e[t]=u(e[t]);return e.join("")}function _(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function m(e,t){var n,s=e.length,i=new ArrayBuffer(s),r=new Uint8Array(i);for(n=0;s>n;n++)r[n]=e.charCodeAt(n);return t?r:i}function p(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function f(e,t,n){var s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e)),s.set(new Uint8Array(t),e.byteLength),n?s:s.buffer}function g(){this.reset()}var S=function(e,t){return e+t&4294967295},b=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==d(h("hello"))&&(S=function(e,t){var n=(65535&e)+(65535&t),s=(e>>16)+(t>>16)+(n>>16);return s<<16|65535&n}),g.prototype.append=function(e){return this.appendBinary(_(e)),this},g.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;n>=t;t+=64)o(this._hash,a(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},g.prototype.end=function(e){var t,n,s=this._buff,i=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;i>t;t+=1)r[t>>2]|=s.charCodeAt(t)<<(t%4<<3);return this._finish(r,i),n=e?this._hash:d(this._hash),this.reset(),n},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},g.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(e,t){var n,s,i,r=t;if(e[r>>2]|=128<<(r%4<<3),r>55)for(o(this._hash,e),r=0;16>r;r+=1)e[r]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(n[2],16),i=parseInt(n[1],16)||0,e[14]=s,e[15]=i,o(this._hash,e)},g.hash=function(e,t){return g.hashBinary(_(e),t)},g.hashBinary=function(e,t){var n=h(e);return t?n:d(n)},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(e){var t,n=f(this._buff.buffer,e,!0),s=n.length;for(this._length+=e.byteLength,t=64;s>=t;t+=64)o(this._hash,c(n.subarray(t-64,t)));return this._buff=s>t-64?n.subarray(t-64):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(e){var t,n,s=this._buff,i=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;i>t;t+=1)r[t>>2]|=s[t]<<(t%4<<3);return this._finish(r,i),n=e?this._hash:d(this._hash),this.reset(),n},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var e=g.prototype.getState.call(this);return e.buff=p(e.buff),e},g.ArrayBuffer.prototype.setState=function(e){return e.buff=m(e.buff,!0),g.prototype.setState.call(this,e)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(e,t){var n=l(new Uint8Array(e));return t?n:d(n)},g}),function(e){"use strict";function t(e,t){return new r.Builder(e,t)}function n(e){return new r.Builder("message",e)}function s(e){return new r.Builder("iq",e)}function i(e){return new r.Builder("presence",e)}var r,o="Strophe.Builder - ",a="Strophe.Connection - ",c="Strophe.Handler - ",h=msos.config.verbose,l=msos.console.debug,u=0;for(r={VERSION:"1.2.3",onIdle_delay:333,NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){var t=0;for(t=0;t<r.XHTML.tags.length;t+=1)if(e===r.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){var n=0;if(void 0!==r.XHTML.attributes[e]&&r.XHTML.attributes[e].length>0)for(n=0;n<r.XHTML.attributes[e].length;n+=1)if(t===r.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){var t=0;for(t=0;t<r.XHTML.css.length;t+=1)if(e===r.XHTML.css[t])return!0;return!1}},addNamespace:function(e,t){r.NS[e]=t},status_name:["ERROR","CONNECTING","CONNFAIL","AUTHENTICATING","AUTHFAIL","CONNECTED","DISCONNECTED","DISCONNECTING","ATTACHED","REDIRECT"],Status:{},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,_xmlGenerator:null,xmlGenerator:function(){if(!r._xmlGenerator){var e=document.implementation.createDocument("jabber:client","strophe",null);r._xmlGenerator=e}return r._xmlGenerator},xmlElement:function(e){if(!e)return null;var t,n,s=r.xmlGenerator().createElement(e),i=0,o=0,a="";for(i=1;i<arguments.length;i+=1)if(t=arguments[i],!msos.var_is_empty(t))if("string"==typeof t||"number"==typeof t)s.appendChild(r.xmlTextNode(t));else if("object"==typeof t&&"function"==typeof t.sort)for(o=0;o<t.length;o+=1)n=t[o],"object"==typeof n&&"function"==typeof n.sort&&void 0!==n[1]&&null!==n[1]&&s.setAttribute(n[0],n[1]);else if("object"==typeof t)for(a in t)t.hasOwnProperty(a)&&void 0!==t[a]&&null!==t[a]&&s.setAttribute(a,t[a]);return s},xmlescape:function(e){return msos.var_is_empty(e)?(msos.console.warn("Strophe.xmlescape -> missing input!"),""):(e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;"))},xmlunescape:function(e){return msos.var_is_empty(e)?(msos.console.warn("Strophe.unxmlescape -> missing input!"),""):(e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,'"'))},xmlTextNode:function(e){return r.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t,n;return window.DOMParser?(n=new DOMParser,t=n.parseFromString(e,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="",n=0;for(0===e.childNodes.length&&e.nodeType===r.ElementType.TEXT&&(t+=e.nodeValue),n=0;n<e.childNodes.length;n+=1)e.childNodes[n].nodeType===r.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return r.xmlescape(t)},copyElement:function(e){var t,n=0;if(e.nodeType===r.ElementType.NORMAL){for(t=r.xmlElement(e.tagName),n=0;n<e.attributes.length;n+=1)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(n=0;n<e.childNodes.length;n+=1)t.appendChild(r.copyElement(e.childNodes[n]))}else e.nodeType===r.ElementType.TEXT&&(t=r.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml_def_length:1e3,createHtml_max_length:1e3,createHtml_cur_length:0,createHtml:function(e,t){var n,s,i,o,a,c,h,u,d,_,m,p,f,g=0,S=0;if(l("Strophe.createHtml -> called, child: "+(t?"true":"false")),e&&e.nodeType===r.ElementType.NORMAL)if(s=e.nodeName.toLowerCase(),r.XHTML.validTag(s))try{for(n=r.xmlElement(s),g=0;g<r.XHTML.attributes[s].length;g+=1)if(i=r.XHTML.attributes[s][g],o=e.getAttribute(i),!msos.var_is_empty(o)&&o!==!1&&0!==o)if("style"===i&&"object"==typeof o&&void 0!==o.cssText&&(o=o.cssText),"style"===i){for(a=[],c=o.split(";"),S=0;S<c.length;S+=1)h=c[S].split(":"),u=h[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),r.XHTML.validCSS(u)&&(d=h[1].replace(/^\s*/,"").replace(/\s*$/,""),a.push(u+": "+d));a.length>0&&(o=a.join("; "),n.setAttribute(i,o))}else n.setAttribute(i,o);for(g=0;g<e.childNodes.length;g+=1)n.appendChild(r.createHtml(e.childNodes[g]),!0)}catch(b){n=r.xmlTextNode(""),msos.console.warn("Strophe - createHtml -> invalid elements in: "+s+", error: "+b)}else for(n=r.xmlGenerator().createDocumentFragment(),g=0;g<e.childNodes.length;g+=1)n.appendChild(r.createHtml(e.childNodes[g]),!0);else if(e&&e.nodeType===r.ElementType.FRAGMENT)for(n=r.xmlGenerator().createDocumentFragment(),g=0;g<e.childNodes.length;g+=1)n.appendChild(r.createHtml(e.childNodes[g]),!0);else{if(!e||e.nodeType!==r.ElementType.TEXT)return void msos.console.error("Strophe - createHtml -> missing input element!");_=e.nodeValue,m=r.createHtml_cur_length,p=r.createHtml_cur_length+_.length,p>r.createHtml_max_length?(f=r.createHtml_max_length-m,r.createHtml_cur_length+=f,_=_.substring(0,f),_+="...",l("Strophe - createHtml -> cropped total text to: "+r.createHtml_max_length)):r.createHtml_cur_length=p,n=r.xmlTextNode(_)}return t!==!0&&(r.createHtml_max_length=r.createHtml_def_length,r.createHtml_cur_length=0),n},escapeNode:function(e){return msos.var_is_empty(e)?(msos.console.warn("Strophe.escapeNode -> missing input!"),""):"string"!=typeof e?(msos.console.warn("Strophe.escapeNode -> input not a string!"),e):e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return msos.var_is_empty(e)?(msos.console.warn("Strophe.unescapeNode -> missing input!"),""):"string"!=typeof e?(msos.console.warn("Strophe.unescapeNode -> input not a string!"),e):e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){var t,n="Strophe.getNodeFromJid -> ";return"strophe"===h&&l(n+"start, jid: "+e),t=e.indexOf("@")<0?null:e.split("@")[0],"strophe"===h&&l(n+"done, node: "+t),t},getDomainFromJid:function(e){var t,n,s="Strophe.getDomainFromJid -> ",i=[];return"strophe"===h&&l(s+"start, jid: "+e),t=r.getBareJidFromJid(e),t.indexOf("@")<0?n=t:(i=t.split("@"),i.splice(0,1),n=i.join("@")),"strophe"===h&&l(s+"done, domain: "+n),n},getResourceFromJid:function(e){var t,n="Strophe.getResourceFromJid -> ",s=e.split("/");return"strophe"===h&&l(n+"start, input jid: "+e),s.length<2?t=null:(s.splice(0,1),t=s.join("/")),"strophe"===h&&l(n+"done, resource: "+t),t},getBareJidFromJid:function(e){var t=e?e.split("/")[0]:null;return"strophe"===h&&l("Strophe.getBareJidFromJid -> called, jid (in): "+e+", bare (out): "+t),t},serialize:function(e){return"function"==typeof e.tree&&(e=e.tree()),jQuery(e)[0].outerHTML},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){r._connectionPlugins[e]=t}},u=0;u<r.status_name.length;u+=1)r.Status[r.status_name[u]]=u;r.Builder=function(e,t){("presence"===e||"message"===e||"iq"===e)&&(t&&!t.xmlns?t.xmlns=r.NS.CLIENT:t||(t={xmlns:r.NS.CLIENT})),this.nodeTree=r.xmlElement(e,t),this.node=this.nodeTree},r.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return r.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){var t="";for(t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var s=r.xmlElement(e,t,n);return this.node.appendChild(s),"string"!=typeof n&&(this.node=s),this},cnode:function(e){var t,n=r.xmlGenerator(),s=!1;try{s=void 0!==n.importNode}catch(i){s=!1,msos.console.warn(o+"cnode -> error: "+i)}return t=s?n.importNode(e,!0):r.copyElement(e),this.node.appendChild(t),this.node=t,this},t:function(e){var t=r.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t,n=document.createElement("body");for(n.innerHTML=e,t=r.createHtml(n);t.childNodes.length>0;)this.node.appendChild(t.childNodes[0]);return this}},r.Handler=function(e,t,n,s,i,r){return this.handler=e,this.ns=t,this.name=n,this.type=s||!1,this.id=i||!1,this.from=r||!1,this.user=!0,this.describe="",this},r.Handler.prototype={isMatch:function(e){var t=jQuery(e),n=!1,s=this;return this.ns?(n=t.attr("xmlns")===this.ns,n||t.children().each(function(e,t){var i=jQuery(t);i.attr("xmlns")===s.ns&&(n=!0)})):n=!0,!n||this.name&&t.prop("tagName").toLowerCase()!==this.name||this.type&&(_.isArray(this.type)?-1===_.indexOf(this.type,t.attr("type")):t.attr("type")!==this.type)||this.id&&t.attr("id")!==this.id||this.from&&t.attr("from")!==this.from?!1:!0},run:function(e){var t=null;h&&l(c+"run -> start, handler:\n    "+this.toString());try{t=this.handler(e)||!1}catch(n){msos.console.error(n.sourceURL?c+"run -> error w/url: "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message+"\n for handler: "+this.toString():n.fileName?c+"run -> error w/file: "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message+"\n for handler: "+this.toString():n.stack?c+"run -> error w/stack: "+n.stack+"\n for handler: "+this.toString():c+"run -> error plain: "+n.message+"\n for handler: "+this.toString())}return h&&l(c+"run -> done!"),t},toString:function(){return"ns: "+this.ns+", name: "+this.name+", type: "+(_.isArray(this.type)?this.type.join(" or "):this.type)+", id: "+this.id+", from: "+this.from+", user: "+this.user+(this.describe?", desc: "+this.describe:"")}},r.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},r.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{ TimedHandler: "+this.handler+"("+this.period+") }"}},r.Connection=function(e,t){this.service=e,this.options=t||{},this.jid="",this.domain=null,this.features=null,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.resource=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this.restored=!1,this.hold=1,this.wait=60,this.window=5,this.ws=null,this.connect_timeout=300,this._keep_alive_timer=2e4,this._data=[],this._requests=[],this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(_.bind(this._onIdle,this),r.onIdle_delay);var n,s,i="";for(i in r._connectionPlugins)n=r._connectionPlugins[i],s=function(){},s.prototype=n,this[i]=new s,this[i].init(this)},r.Connection.prototype={pause:function(){this.paused=!0},resume:function(){this.paused=!1},debug_count:0,getUniqueId:function(e){var t,n,s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",i="4xx-yxx";return msos.config.debug?(this.debug_count+=1,n=String(10*this.debug_count)+"-"+i):n=s,t=n.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}),("string"==typeof e||"number"==typeof e)&&(t+=":"+e),String(t)},debugInput:function(e){h&&(l(a+".debugInput\n<<<<",e),l("<<<<"))},debugOutput:function(e){h&&l(a+".debugOutput\n>>>>\n"+e+"\n>>>>")},mechanisms:{},_changeConnectStatus:function(e,t){var n,s,i="_changeConnectStatus -> ",o="",c=r.status_name[e],u="callback.";h&&l(a+i+"start, status: "+c);for(o in r._connectionPlugins)n=this[o],n.statusChanged&&(s=n.statusChanged(e,t),h&&l(a+i+"plugin: "+o+", initialized: "+s));"function"==typeof this.connect_callback?(this.connect_callback(e,t),u="w/ "+u):u="w/o "+u,h&&l(a+i+" done, status: "+c+", "+(t?t+", ":"")+u)},authenticate:function(e){var n,s,i,o,c="authenticate -> ",u=0,d=0,m=!1;for(h&&l(a+c+"start, matched length: "+e.length),u=0;u<e.length-1;u+=1){for(i=u,d=u+1;d<e.length;d+=1)e[d].priority>e[i].priority&&(i=d);i>d&&(o=e[u],e[u]=e[i],e[i]=o)}for(u=0;u<e.length;u+=1)"function"==typeof e[u].test&&e[u].test(this)&&(this._sasl_success_handler=this.addStropheHandler(_.bind(this._sasl_success_cb,this),r.NS.SASL,"success"),this._sasl_success_handler.user=!1,this._sasl_failure_handler=this.addStropheHandler(_.bind(this._sasl_failure_cb,this),r.NS.SASL,"failure"),this._sasl_failure_handler.user=!1,this._sasl_challenge_handler=this.addStropheHandler(_.bind(this._sasl_challenge_cb,this),r.NS.SASL,"challenge"),this._sasl_challenge_handler.user=!1,this._sasl_mechanism=new e[u],this._sasl_mechanism.onStart(this),n=t("auth",{xmlns:r.NS.SASL,mechanism:this._sasl_mechanism.name}),this._sasl_mechanism.isClientFirst&&(s=this._sasl_mechanism.onChallenge(this,null),n.t(Base64.encode(s))),this.send(n.tree()),m=!0,l(a+c+"mechanism found: "+this._sasl_mechanism.name));m?this._changeConnectStatus(r.Status.AUTHENTICATING,null):(msos.console.error(a+c+"no authorization mechanisms found."),this._changeConnectStatus(r.Status.CONNFAIL,"strophe_no_auth_mechanism"),this.server_disconnect("strophe_no_auth_mechanism")),h&&l(a+c+"done!")},sendIQ:function(e,t,n,s,i){var o,c,u,d="sendIQ -> ",_=null,m=this,p="";return l(a+d+"start, description: '"+t+"'"),"function"==typeof e.tree&&(e=e.tree()),p=e.getAttribute("id"),p||(p=this.getUniqueId("sendIQ"),e.setAttribute("id",p)),o=e.getAttribute("to"),c=this.jid,u=this.addStropheHandler(function(e){_&&m.deleteTimedHandler(_);var t,i=!1,u=e.getAttribute("from");return(u===o||null===o&&(u===r.getBareJidFromJid(c)||u===r.getDomainFromJid(c)||u===c))&&(i=!0),i?(t=e.getAttribute("type"),void("result"===t?(h&&l(a+d+"success, id: "+p),n&&n(e)):"error"===t?(h&&l(a+d+"error, id: "+p),s&&s(e)):msos.console.error(a+d+"failed, id: "+p+", for bad IQ type: "+t))):(msos.console.error(a+d+"failed, response jid: "+u+", for jid: "+o),void this._changeConnectStatus(r.Status.ERROR,"strophe_invalid_id"))},r.NS.CLIENT,"iq",["error","result"],p),u.describe=t,i&&(_=this.addTimedHandler(i,function(){return m.deleteHandler(u),s&&s(null),!1})),this.send(e),l(a+d+"done, id: "+p),p},_sasl_challenge_cb:function(e){var n=Base64.decode(r.getText(e)),s=this._sasl_mechanism.onChallenge(this,n);return this.send(t("response",{xmlns:r.NS.SASL}).t(Base64.encode(s)).tree()),!0},_sasl_auth1_cb:function(e){var t,n,i,o=0;for(h&&l(a+"_sasl_auth1_cb -> start."),o=0;o<e.childNodes.length;o+=1)t=e.childNodes[o],"bind"===t.nodeName&&(this.do_bind=!0),"session"===t.nodeName&&(this.do_session=!0);return this.do_bind?(i=this.addStropheHandler(_.bind(this._sasl_bind_cb,this),r.NS.CLIENT,"iq",["error","result"],"_bind_auth_2"),i.user=!1,n=r.getResourceFromJid(this.jid),this.send(n?s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).c("resource",{}).t(n).tree():s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).tree()),h&&l(a+"_sasl_auth1_cb -> done!"),!1):(this._changeConnectStatus(r.Status.AUTHFAIL,"strophe_auth_failed"),l(a+"_sasl_auth1_cb -> done, AUTHFAIL"),!1)},_sasl_bind_cb:function(e){var t,n,i,o,c,u,d,m,p="sasl_auth_bind_error";return h&&l(a+"_sasl_bind_cb -> start."),"error"===e.getAttribute("type")?(m=e.getElementsByTagName("conflict"),m.length>0&&(p="sasl_auth_bind_conflict"),this._changeConnectStatus(r.Status.AUTHFAIL,p),h&&l(a+"_sasl_bind_cb -> done, SASL binding failed."),!1):(t=e.getElementsByTagName("bind"),t.length>0&&(n=t[0].getElementsByTagName("jid"),n.length>0)?(i=r.getText(n[0]),o=r.getNodeFromJid(i),c=r.getDomainFromJid(i),u=r.getResourceFromJid(i),o===u?this.jid=o+"@"+c+"/"+u:(msos.console.warn(a+"_sasl_bind_cb -> using jid w/o domain or resource: "+i),this.jid=i),this.do_session?(d=this.addStropheHandler(_.bind(this._sasl_session_cb,this),r.NS.CLIENT,"iq",["error","result"],"_session_auth_2"),d.user=!1,this.send(s({type:"set",id:"_session_auth_2"}).c("session",{xmlns:r.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null)),h&&l(a+"_sasl_bind_cb -> done, node count: "+n.length),!1):(msos.console.warn(a+"_sasl_bind_cb -> done, SASL binding failed."),!0))},_sasl_session_cb:function(e){if(h&&l(a+"_sasl_session_cb -> start."),"result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return msos.console.warn(a+"_sasl_session_cb -> session creation failed."),this._changeConnectStatus(r.Status.AUTHFAIL,"sasl_session_failed"),!0;return h&&l(a+"_sasl_session_cb -> done!"),!1},_sasl_failure_cb:function(e){return h&&l(a+"_sasl_failure_cb -> start."),this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(r.Status.AUTHFAIL,"sasl_server_failed"),h&&l(a+"_sasl_failure_cb -> done!"),!1},addTimedHandler:function(e,t){var n=new r.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},deleteHandler:function(e){this.removeHandlers.push(e)},addStropheHandler:function(e,t,n,s,i,o){var c=new r.Handler(e,t,n,s,i,o);return this.addHandlers.push(c),h&&l(a+"addStropheHandler -> called, added:\n    "+c.toString()),c},_addSysTimedHandler:function(e,t){var n=new r.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_queueData:function(e){null!==e&&e.tagName&&e.childNodes?this._data.push(e):msos.console.error(a+"_queueData -> can not queue non-DOMElement."),h&&l(a+"_queueData -> called, queued requests: "+this._data.length)},_sasl_success_cb:function(e){var t,n,s,i,o,c,u=/([a-z]+)=([^,]+)(,|$)/,d=[],m=[],p=this;return h&&l(a+"_sasl_success_cb -> start."),this._sasl_data["server-signature"]&&(n=Base64.decode(r.getText(e)),d=n.match(u),"v"===d[1]&&(t=d[2]),t!==this._sasl_data["server-signature"])?(this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},l(a+"_sasl_success_cb -> done, failed!"),this._sasl_failure_cb(null)):(h&&l(a+"_sasl_success_cb -> SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),o=function(e,t){for(var n=_.bind(p._sasl_auth1_cb,p);e.length;)p.deleteHandler(e.pop());return n(t),!1},s=this.addStropheHandler(function(e){o(m,e)},!1,"stream:features"),s.user=!1,m.push(s),i=this.addStropheHandler(function(e){o(m,e)},r.NS.STREAM,"features"),i.user=!1,m.push(i),c=_.bind(this._onIdle,this),this._data.push("restart"),clearTimeout(this._idleTimeout),c(),this._idleTimeout=setTimeout(c,r.onIdle_delay),h&&l(a+"_sasl_success_cb -> done!"),!1)},_dataRecv:function(e){var t,n,s,i,o,c,u="_dataRecv -> ",d=0,m=this;if(l(a+u+"start, add: "+this.addHandlers.length+", remove: "+this.removeHandlers.length+" handlers."),msos.var_is_empty(e))return void msos.console.warn(a+u+"done, no stanza");if(this.debugInput(e),this.disconnecting&&0===this._requests.length)return this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null,this.client_disconnect(),void l(a+u+"done, graceful disconnect.");for(;this.removeHandlers.length>0;)s=this.removeHandlers.pop(),d=_.indexOf(this.handlers,s),d>=0&&(t=this.handlers.splice(d,1),h&&l(a+u+"removed:\n    "+t.toString()));for(;this.addHandlers.length>0;)n=this.addHandlers.pop(),this.handlers.push(n),h&&l(a+u+"added:\n    "+n.toString());return i=e.getAttribute("type"),null!==i&&"terminate"===i?this.disconnecting?void l(a+u+"done, too late to process."):(o=e.getAttribute("condition"),c=e.getElementsByTagName("conflict"),null!==o?"remote-stream-error"===o&&c.length>0&&(o="strophe_stream_conflict"):o="strophe_connection_failure",this._changeConnectStatus(r.Status.CONNFAIL,o),msos.console.warn(a+u+"done, w/ problems: "+o),void this.server_disconnect(o)):(jQuery(e).children().each(function(e,t){var n,s=0;for(s=0;s<m.handlers.length;s+=1)n=m.handlers[s],!n.isMatch(t)||!m.authenticated&&n.user||(l(a+u+"processing handler:\n    "+n.toString()),n.run(t)||m.removeHandlers.push(n))}),l(a+u+"done, for handler count: "+this.handlers.length),void("strophe"===h&&jQuery.each(this.handlers,function(e,t){l(" "+e+". "+t.toString())})))},client_disconnect:function(e){var t="client_disconnect -> ";return l(a+t+"start."),"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),window.sessionStorage.removeItem("strophe-bosh-session"),this._changeConnectStatus(r.Status.DISCONNECTED,e),this.connected=!1,this._closeSocket(),l(a+t+"done!"),new r.Connection(this.service,this.options)},_connect_cb:function(e){var t,n,s,i="_connect_cb -> ",o=[],c=0,h=!1;if(l(a+i+"start."),!e)return void l(a+i+"done, no response.");if(this.connected=!0,this.debugInput(e),this._check_streamerror(e,r.Status.CONNFAIL))return void l(a+i+"done, connection failed.");if(this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1,t=e.getElementsByTagNameNS(r.NS.STREAM,"stream:features").length>0||e.getElementsByTagNameNS(r.NS.STREAM,"features").length>0,!t)return l(a+i+"failed, no stream features found!"),void l(a+i+"done!");if(n=e.getElementsByTagName("mechanism"),n.length>0)for(c=0;c<n.length;c+=1)s=r.getText(n[c]),this.mechanisms[s]&&o.push(this.mechanisms[s]);return this._authentication.legacy_auth=e.getElementsByTagName("auth").length>0,(h=this._authentication.legacy_auth||o.length>0)?(this.do_authentication!==!1&&this.authenticate(o),void l(a+i+"done!")):(this._changeConnectStatus(r.Status.CONNFAIL,"strophe_connection_failure"),this.client_disconnect(),void l(a+i+"done, no authentication mechanisms found."))},connect:function(e,t,n,s,i,o,c){l(a+"connect -> start, jid: "+e),this.jid=e,this.authzid=r.getBareJidFromJid(this.jid),this.authcid=c||r.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.errors=0,this.domain=r.getDomainFromJid(this.jid),this.resource=r.getResourceFromJid(this.jid),this._changeConnectStatus(r.Status.CONNECTING,null),this.ws=new WebSocket(this.service,this.servtype),this.ws.onopen=_.bind(this._ws_on_open,this),this.ws.onerror=_.bind(this._ws_on_error,this),this.ws.onclose=_.bind(this._ws_on_close,this),this.ws.onmessage=_.bind(this._ws_on_message_initialize,this),l(a+"connect -> done, jid: "+e)},server_disconnect:function(e){var t="server_disconnect -> ",n=!1;l(a+t+"start, reason: "+e),this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._changeConnectStatus(r.Status.DISCONNECTING,e),this.connected?(this.disconnecting=!0,this.authenticated&&(n=i({xmlns:r.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,_.bind(this.client_disconnect,this)),this._sendTerminate(n)):msos.console.warn(a+t+"Strophe not connected yet."),l(a+t+"done!")},send:function(e){var t=0;if(l(a+"send -> start."),msos.var_is_null(e))return void msos.console.error(a+"send -> done, missing input!");if("function"==typeof e.sort)for(t=0;t<e.length;t+=1)this._queueData(e[t]);else this._queueData("function"==typeof e.tree?e.tree():e);clearTimeout(this._idleTimeout),this._onIdle(),l(a+"send -> done!")},_onIdle:function(){for(var e,t,n,s,i=0,o=this._data,a=[],c=(new Date).getTime();this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),
i=_.indexOf(this.timedHandlers,e),i>=0&&this.timedHandlers.splice(i,1);for(i=0;i<this.timedHandlers.length;i+=1)e=this.timedHandlers[i],(this.authenticated||!e.user)&&(t=e.lastCalled+e.period,0>=t-c?e.run()&&a.push(e):a.push(e));if(this.timedHandlers=a,clearTimeout(this._idleTimeout),o.length>0&&!this.paused){for(i=0;i<o.length;i+=1)null!==o[i]&&(n="restart"===o[i]?this._buildStream().tree():o[i],s=r.serialize(n),this.debugOutput(s),this.ws.send(s));this._data=[]}this.connected&&(this._idleTimeout=setTimeout(_.bind(this._onIdle,this),r.onIdle_delay))},_sendTerminate:function(e){var n,s,i="_sendTerminate -> ";if(l(a+i+"start."),this.ws&&this.ws.readyState!==WebSocket.CLOSED){e&&this.send(e),n=t("close",{xmlns:r.NS.FRAMING}),s=r.serialize(n),this.debugOutput(s);try{this.ws.send(s)}catch(o){msos.console.error(a+i+"failed to send <close /> tag:",o)}}this.client_disconnect(),l(a+i+"done!")},_buildStream:function(){return t("open",{xmlns:r.NS.FRAMING,to:this.domain,version:"1.0"})},_closeSocket:function(){var e="_closeSocket -> ";if(this.ws&&this.ws.readyState!==WebSocket.CLOSED)try{this.ws.close()}catch(t){msos.console.warn(a+e+"socket closing problem: ",t)}else msos.console.warn(a+e+"missing websocket or already closed.");this.ws=null},_handleStreamStart:function(e){var t,n="_handleStreamStart -> ",s=!1,i=e.getAttribute("xmlns");return h&&l(a+n+"start."),"string"!=typeof i?s="Missing xmlns in <open />":i!==r.NS.FRAMING&&(s="Wrong xmlns in <open />: "+i),t=e.getAttribute("version"),"string"!=typeof t?s="Missing version in <open />":"1.0"!==t&&(s="Wrong version in <open />: "+t),s?(this._changeConnectStatus(r.Status.CONNFAIL,"strophe_stream_conflict"),this.client_disconnect(),msos.console.error(a+n+"failed for: "+s),!1):(h&&l(a+n+"done, success!"),!0)},_check_streamerror:function(e,t){var n,s,i,o="_check_streamerror -> ",c="",u="",d="urn:ietf:params:xml:ns:xmpp-streams",_="WebSocket stream error: ",m=0;if(h&&l(a+o+"start, for status: "+t),n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(r.NS.STREAM,"error")||[]:e.getElementsByTagName("stream:error"),0===n.length)return h&&l(a+o+"done, no errors!"),!1;for(s=n[0],m=0;m<s.childNodes.length&&(i=s.childNodes[m],i.getAttribute("xmlns")===d);m+=1)"text"===i.nodeName?u=i.textContent:c=i.nodeName;return _+=c?c:"unknown",u&&(_+=" - "+c),msos.console.error(a+o+"error detected, condition: "+_),this._changeConnectStatus(t,c),this.client_disconnect(),h&&l(a+o+"done, with errors!"),!0},strip:"wrapper",_streamWrap:function(e){return'<body xmlns="'+r.NS.HTTPBIND+'" ack="'+this.rid+'">'+e+"</body>"},_ws_on_open:function(){var e,t;l(a+"_ws_on_open -> start."),e=this._buildStream(),t=r.serialize(e),this.debugOutput(t),this.ws.send(t),l(a+"_ws_on_open -> done!")},_ws_on_message:function(e){var t,n,s="_ws_on_message -> ",i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(h&&l(a+s+"start."),this.debugInput(e),e.data===i)return this.disconnecting||this.client_disconnect(),void(h&&l(a+s+"done, closing!"));if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return void(h&&l(a+s+"done, stream start failed!"))}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;return l(a+s+"parsed stream element."),this.debugInput(t),this._check_streamerror(t,r.Status.ERROR)?void(h&&l(a+s+"done, stream error!")):this.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?void(h&&l(a+s+"done, waiting to disconnect!")):(this._dataRecv(t),void(h&&l(a+s+"done, success!")))},_ws_on_message_initialize:function(e){var t,n,s,i="_ws_on_message_initialize -> ",o=e.data;return l(a+i+"start."),msos.var_is_empty(o)?void l(a+i+"done, no data!"):void(0===o.indexOf("<open ")?(l(a+i+"received open tag."),t=(new DOMParser).parseFromString(o,"text/xml").documentElement,this.debugInput(t),this._handleStreamStart(t)||msos.console.warn(a+i+"done, for start stream error!"),this._check_streamerror(t,r.Status.CONNFAIL)&&msos.console.warn(a+i+"done, for stream connection error!"),l(a+i+"done.")):0===o.indexOf("<close ")?(l(a+i+"received close tag."),this._changeConnectStatus(r.Status.CONNFAIL,"strophe_connection_failure"),this.client_disconnect(),l(a+i+"done, disconnecting.")):(this.ws.onmessage=_.bind(this._ws_on_message,this),l(a+i+"Strophe._ws_on_message bound to ws."),n=this._streamWrap(o),s=(new DOMParser).parseFromString(n,"text/xml").documentElement,this._connect_cb(s),l(a+i+"done, message success!")))},_ws_on_error:function(e){var t=e.data||"missing or bad connection.";msos.console.error(a+"_ws_on_error -> error: "+t,e),this._changeConnectStatus(r.Status.CONNFAIL,"strophe_connection_failure"),this._sendTerminate()},_ws_on_close:function(e){this.connected&&!this.disconnecting?(msos.console.warn(a+"_ws_on_close -> websocket closed unexpectedly!"),this.client_disconnect()):l(a+"_ws_on_close -> called, websocket closed.")}},r.SASLMechanism=function(e,t,n){return this.name=e,this.isClientFirst=t,this.priority=n,this._sasl_mech_data={},this.test=function(e){return!0},this.onStart=function(e){this._connection=e},this.onChallenge=function(e,t){throw new Error("You should implement challenge handling!")},this.onFailure=function(){this._connection=null},this.onSuccess=function(){this._connection=null},this._quote=function(e){return msos.var_is_empty(e)?(msos.console.warn("Strophe.SASLMechanism._quote -> missing input!"),""):'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},this},r.SASLAnonymous=function(){},r.SASLAnonymous.prototype=new r.SASLMechanism("ANONYMOUS",!1,10),r.SASLAnonymous.test=function(e){return null===e.authcid},r.SASLPlain=function(){},r.SASLPlain.prototype=new r.SASLMechanism("PLAIN",!0,20),r.SASLPlain.test=function(e){return null!==e.authcid},r.SASLPlain.prototype.onChallenge=function(e,t){var n=e.authzid;return n+="\x00",n+=e.authcid,n+="\x00",n+=e.pass},r.SASLSHA1=function(){},r.SASLSHA1.prototype=new r.SASLMechanism("SCRAM-SHA-1",!0,20),r.SASLSHA1.test=function(e){return null!==e.authcid},r.SASLSHA1.prototype.onChallenge=function(e,t,n){var s=n||SparkMD5.hash(1234567890*Math.random()),i="n="+e.authcid+",r="+s;return h&&l("Strophe.SASLSHA1.onChallenge -> called."),this._sasl_mech_data.cnonce=s,this._sasl_mech_data["client-first-message-bare"]=i,i="n,,"+i,this.onChallenge=function(e,t){for(var n,s,i,r,o,a,c,h,l,u=[],d="c=biws,",_=this._sasl_mech_data["client-first-message-bare"]+","+t+",",m=this._sasl_mech_data.cnonce,p=/([a-z]+)=([^,]+)(,|$)/,f=0,g=0;t.match(p);)switch(u=t.match(p),t=t.replace(u[0],""),u[1]){case"r":n=u[2];break;case"s":s=u[2];break;case"i":i=u[2]}if(n.substr(0,m.length)!==m)return this._sasl_mech_data={},e._sasl_failure_cb();for(d+="r="+n,_+=d,s=Base64.decode(s),s+="",r=a=core_hmac_sha1(e.pass,s),f=1;i>f;f+=1){for(o=core_hmac_sha1(e.pass,binb2str(a)),g=0;5>g;g+=1)r[g]^=o[g];a=o}for(r=binb2str(r),c=core_hmac_sha1(r,"Client Key"),h=str_hmac_sha1(r,"Server Key"),l=core_hmac_sha1(str_sha1(binb2str(c)),_),e._sasl_data["server-signature"]=b64_hmac_sha1(h,_),g=0;5>g;g+=1)c[g]^=l[g];return d+=",p="+Base64.encode(binb2str(c))},_.bind(this.onChallenge,this),i},r.SASLMD5=function(){},r.SASLMD5.prototype=new r.SASLMechanism("DIGEST-MD5",!1,20),r.SASLMD5.test=function(e){return null!==e.authcid},r.SASLMD5.prototype.onChallenge=function(e,t,n){var s,i,r,o,a=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,c=n||SparkMD5.hash(String(1234567890*Math.random())),u="",d=null,m="",p="",f="";for(h&&l("Strophe.SASLMD5.onChallenge -> called.");t.match(a);)switch(s=t.match(a),t=t.replace(s[0],""),s[2]=s[2].replace(/^"(.+)"$/,"$1"),s[1]){case"realm":u=s[2];break;case"nonce":m=s[2];break;case"qop":p=s[2];break;case"host":d=s[2]}return i=e.servtype+"/"+e.domain,null!==d&&(i=i+"/"+d),r=SparkMD5.hash(e.authcid+":"+u+":"+this._connection.pass)+":"+m+":"+c,o="AUTHENTICATE:"+i,f+="charset=utf-8,",f+="username="+this._quote(e.authcid)+",",f+="realm="+this._quote(u)+",",f+="nonce="+this._quote(m)+",",f+="nc=00000001,",f+="cnonce="+this._quote(c)+",",f+="digest-uri="+this._quote(i)+",",f+="response="+SparkMD5.hash(SparkMD5.hash(r)+":"+m+":00000001:"+c+":auth:"+SparkMD5.hash(o))+",",f+="qop=auth",this.onChallenge=_.bind(function(e,t){return""},this),f},e(r,t,n,s,i)}(function(){"use strict";var e=Array.prototype.slice.call(arguments);window.Strophe=e[0],window.$build=e[1],window.$msg=e[2],window.$iq=e[3],window.$pres=e[4]}),Strophe.addConnectionPlugin("muc",{_connection:null,_p_name:"strophe.plugins.muc - ",init:function(e){"use strict";msos.console.debug(this._p_name+"init -> start."),this._connection=e,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),msos.console.debug(this._p_name+"init -> done!")},join:function(e,t,n,s,i){"use strict";msos.console.debug(this._p_name+"join -> start.");var r,o,a,c,h=this._append_nick(e,t);r=$pres({from:this._connection.jid,to:h}).c("x",{xmlns:Strophe.NS.MUC}),i&&(o=Strophe.xmlElement("password",[],i),r.cnode(o)),n&&(a=this._connection.addStropheHandler(function(t){var s=t.getAttribute("from"),i=s.split("/");return msos.console.debug(this._p_name+"join -> done, msg callback."),i[0]===e?n(t):!0},Strophe.NS.CLIENT,"message"),a.describe="MUC join: "+h),s&&(c=this._connection.addStropheHandler(function(e){var t,n=e.getElementsByTagName("x"),i=0;if(n.length>0)for(i=0;i<n.length;i+=1)if(t=n[i].getAttribute("xmlns"),t&&t.match(Strophe.NS.MUC))return msos.console.debug(this._p_name+"join -> done, pres callback."),s(e);return!0},Strophe.NS.CLIENT,"presence"),c.describe="MUC join: "+h),this._connection.send(r),msos.console.debug(this._p_name+"join -> done!")},leave:function(e,t,n){"use strict";msos.console.debug(this._p_name+"leave -> start.");var s,i=this._append_nick(e,t),r=this._connection.getUniqueId(),o=$pres({type:"unavailable",id:r,from:this._connection.jid,to:i}).c("x",{xmlns:Strophe.NS.MUC});return s=this._connection.addStropheHandler(n,Strophe.NS.CLIENT,"presence",!1,r),this._connection.send(o),msos.console.debug(this._p_name+"leave -> done, room jid: "+i),r},message:function(e,t,n,s){"use strict";msos.console.debug(this._p_name+"message -> start.");var i,r=this._append_nick(e,t),o=this._connection.getUniqueId();return s=s||"groupchat",i=$msg({to:r,from:this._connection.jid,type:s,id:o}).c("body",{xmlns:Strophe.NS.CLIENT}).t(n),i.up().c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(i),msos.console.debug(this._p_name+"message -> done!"),o},configure:function(e){"use strict";msos.console.debug(this._p_name+"configure -> called.");var t=$iq({to:e,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),n=t.tree();return this._connection.sendIQ(n,"get: query MUC owner")},cancelConfigure:function(e){"use strict";msos.console.debug(this._p_name+"cancelConfigure -> called.");var t=$iq({to:e,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=t.tree();return this._connection.sendIQ(n,"set: query MUC owner, x cancel")},saveConfiguration:function(e,t){"use strict";msos.console.debug(this._p_name+"saveConfiguration -> called.");var n,s=$iq({to:e,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),i=0;for(i=0;i<t.length;i+=1)s.cnode(t[i]),s.up();return n=s.tree(),this._connection.sendIQ(n,"set: query MUC owner, x submit (array up)")},createInstantRoom:function(e){"use strict";msos.console.debug(this._p_name+"createInstantRoom -> called.");var t=$iq({to:e,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"});return this._connection.sendIQ(t.tree(),"set: query MUC owner, x submit")},setTopic:function(e,t){"use strict";msos.console.debug(this._p_name+"setTopic -> called.");var n=$msg({to:e,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(t);this._connection.send(n.tree())},modifyUser:function(e,t,n,s,i){"use strict";msos.console.debug(this._p_name+"modifyUser -> called.");var r,o,a={nick:Strophe.escapeNode(t)};return null!==n&&(a.role=n),null!==s&&(a.affiliation=s),r=$build("item",a),null!==i&&r.cnode(Strophe.xmlElement("reason",i)),o=$iq({to:e,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).cnode(r.tree()),this._connection.sendIQ(o.tree(),"set: query MUC owner")},changeNick:function(e,t){"use strict";msos.console.debug(this._p_name+"changeNick -> called.");var n=this._append_nick(e,t),s=$pres({from:this._connection.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC});this._connection.send(s.tree())},listRooms:function(e,t){"use strict";msos.console.debug(this._p_name+"listRooms -> called.");var n=$iq({to:e,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});this._connection.sendIQ(n,"get: query disco items (MUC)",t)},_append_nick:function(e,t){"use strict";var n=e;return t&&(n+="/"+Strophe.escapeNode(t)),msos.console.debug(this._p_name+"_append_nick -> called, room jid: "+n),n}}),Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],_p_name:"strophe.plugins.disco - ",init:function(e){"use strict";msos.console.debug(this._p_name+"init -> start."),this._connection=e,this._identities=[],this._features=[],this._items=[],msos.console.debug(this._p_name+"init -> done!")},statusChanged:function(e){"use strict";return e===Strophe.Status.CONNECTED?(this._connection.addStropheHandler(_.bind(this._onDiscoInfo,this),Strophe.NS.DISCO_INFO,"iq","get"),this._connection.addStropheHandler(_.bind(this._onDiscoItems,this),Strophe.NS.DISCO_ITEMS,"iq","get"),!0):!1},addIdentity:function(e,t,n,s){"use strict";var i=0;for(i=0;i<this._identities.length;i+=1)if(this._identities[i].category===e&&this._identities[i].type===t&&this._identities[i].name===n&&this._identities[i].lang===s)return!1;return this._identities.push({category:e,type:t,name:n,lang:s}),!0},addFeature:function(e){"use strict";var t=0;for(t=0;t<this._features.length;t+=1)if(this._features[t]===e)return!1;return this._features.push(e),!0},removeFeature:function(e){"use strict";var t=0;for(t=0;t<this._features.length;t+=1)if(this._features[t]===e)return this._features.splice(t,1),!0;return!1},addItem:function(e,t,n,s){"use strict";return n&&!s?!1:(this._items.push({jid:e,name:t,node:n,call_back:s}),!0)},info:function(e,t,n,s,i){"use strict";var r,o={xmlns:Strophe.NS.DISCO_INFO};t&&(o.node=t),r=$iq({from:this._connection.jid,to:e,type:"get"}).c("query",o),this._connection.sendIQ(r,"get: query disco info",n,s,i)},items:function(e,t,n,s,i){"use strict";var r,o={xmlns:Strophe.NS.DISCO_ITEMS};t&&(o.node=t),r=$iq({from:this._connection.jid,to:e,type:"get"}).c("query",o),this._connection.sendIQ(r,"get: query disco items",n,s,i)},_buildIQResult:function(e,t){"use strict";var n=e.getAttribute("id"),s=e.getAttribute("from"),i=$iq({type:"result",id:n});return null!==s&&i.attrs({to:s}),i.c("query",t)},_onDiscoInfo:function(e){"use strict";var t,n,s=e.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:Strophe.NS.DISCO_INFO};for(s&&(i.node=s),n=this._buildIQResult(e,i),t=0;t<this._identities.length;t+=1)i={category:this._identities[t].category,type:this._identities[t].type},this._identities[t].name&&(i.name=this._identities[t].name),this._identities[t].lang&&(i["xml:lang"]=this._identities[t].lang),n.c("identity",i).up();for(t=0;t<this._features.length;t+=1)n.c("feature",{"var":this._features[t]}).up();return this._connection.send(n.tree()),!0},_onDiscoItems:function(e){"use strict";var t,n,s,i,r={xmlns:Strophe.NS.DISCO_ITEMS},o=e.getElementsByTagName("query")[0].getAttribute("node");if(o){for(r.node=o,t=[],n=0;n<this._items.length;n+=1)if(this._items[n].node===o){t=this._items[n].call_back(e);break}}else t=this._items;for(s=this._buildIQResult(e,r),n=0;n<t.length;n+=1)i={jid:t[n].jid},t[n].name&&(i.name=t[n].name),t[n].node&&(i.node=t[n].node),s.c("item",i).up();return this._connection.send(s.tree()),!0}}),Strophe.addConnectionPlugin("caps",{HASH:"sha-1",node:"http://strophe.im/strophejs/",_ver:"",_connection:null,_knownCapabilities:{},_jidVerIndex:{},_p_name:"strophe.plugins.caps - ",init:function(e){"use strict";if(msos.console.debug(this._p_name+"init -> start."),this._connection=e,Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),!this._connection.disco)throw"Caps plugin requires the disco plugin to be installed.";this._connection.disco.addFeature(Strophe.NS.CAPS),this._connection.disco.addFeature(Strophe.NS.DISCO_INFO),this._connection.disco.addFeature(Strophe.NS.RECEIPTS),msos.console.debug(this._p_name+"init -> done!")},statusChanged:function(e){"use strict";return e===Strophe.Status.CONNECTING?(this._connection.addStropheHandler(_.bind(this._delegateCapabilities,this),Strophe.NS.CAPS,"presence"),!0):!1},generateCapsAttrs:function(){"use strict";return{xmlns:Strophe.NS.CAPS,hash:this.HASH,node:this.node,ver:this.generateVer()}},generateVer:function(){"use strict";function e(e,t){var n=(65535&e)+(65535&t),s=(e>>16)+(t>>16)+(n>>16);return s<<16|65535&n}function t(e){var t=[],n=255,s=0;for(s=0;s<8*e.length;s+=8)t[s>>5]|=(e.charCodeAt(s/8)&n)<<24-s%32;return t}function n(e,t){return e<<t|e>>>32-t}function s(e,t,n,s){return 20>e?t&n|~t&s:40>e?t^n^s:60>e?t&n|t&s|n&s:t^n^s}function i(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function r(t,r){t[r>>5]|=128<<24-r%32,t[(r+64>>9<<4)+15]=r;var o,a,c,h,l,u,d,_,m=new Array(80),p=1732584193,f=-271733879,g=-1732584194,S=271733878,b=-1009589776;for(o=0;o<t.length;o+=16){for(h=p,l=f,u=g,d=S,_=b,a=0;80>a;a+=1)m[a]=16>a?t[o+a]:n(m[a-3]^m[a-8]^m[a-14]^m[a-16],1),c=e(e(n(p,5),s(a,f,g,S)),e(e(b,m[a]),i(a))),b=S,S=g,g=n(f,30),f=p,p=c;p=e(p,h),f=e(f,l),g=e(g,u),S=e(S,d),b=e(b,_)}return[p,f,g,S,b]}function o(e){var t,n,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",r=0;for(r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;4>n;n+=1)i+=8*r+6*n>32*e.length?"=":s.charAt(t>>6*(3-n)&63);return i}function a(e){return o(r(t(e),8*e.length))}if(""!==this._ver)return this._ver;var c,h=0,l="",u=this._connection.disco._identities.sort(this._sortIdentities),d=u.length,_=this._connection.disco._features.sort(),m=_.length;for(h=0;d>h;h+=1)c=u[h],l+=c.category+"/"+c.type+"/"+c.lang+"/"+c.name+"<";for(h=0;m>h;h+=1)l+=_[h]+"<";return this._ver=a(l),this._ver},getCapabilitiesByJid:function(e){"use strict";return this._jidVerIndex[e]?this._knownCapabilities[this._jidVerIndex[e]]:null},_delegateCapabilities:function(e){"use strict";var t=e.getAttribute("from"),n=e.querySelector("c"),s=n.getAttribute("ver"),i=n.getAttribute("node");return this._knownCapabilities[s]?(this._jidVerIndex[t]=s,this._jidVerIndex[t]&&!this._jidVerIndex[t]===s||(this._jidVerIndex[t]=s),!0):this._requestCapabilities(t,i,s)},_requestCapabilities:function(e,t,n){"use strict";var s;return e!==this._connection.jid&&(s=this._connection.disco.info(e,t+"#"+n),this._connection.addStropheHandler(_.bind(this._handleDiscoInfoReply,this),Strophe.NS.DISCO_INFO,"iq","result",s,e)),!0},_handleDiscoInfoReply:function(e){"use strict";var t,n,s,i=e.querySelector("query"),r=i.getAttribute("node").split("#"),o=r[1],a=e.getAttribute("from"),c=0;if(this._knownCapabilities[o])this._jidVerIndex[a]&&!this._jidVerIndex[a]===o||(this._jidVerIndex[a]=o);else{for(t=i.childNodes,n=t.length,this._knownCapabilities[o]=[],c=0;n>c;c+=1)s=t[c],this._knownCapabilities[o].push({name:s.nodeName,attributes:s.attributes});this._jidVerIndex[a]=o}return!1},_sortIdentities:function(e,t){"use strict";return e.category>t.category?1:e.category<t.category?-1:e.type>t.type?1:e.type<t.type?-1:e.lang>t.lang?1:e.lang<t.lang?-1:0}}),Strophe.addConnectionPlugin("roster",{_p_name:"strophe.plugins.roster - ",init:function(e){msos.console.debug(this._p_name+"init -> start."),this._connection=e,this._callbacks=[],this._callbacks_request=[],this.items=[],ver=null;var t,n;roster=this,_connect=e.connect,_attach=e.attach,n=function(n){var s,i;(n==Strophe.Status.ATTACHED||n==Strophe.Status.CONNECTED)&&(s=e.addStropheHandler(_.bind(roster._onReceivePresence,roster),Strophe.NS.CLIENT,"presence"),i=e.addStropheHandler(_.bind(roster._onReceiveIQ,roster),Strophe.NS.ROSTER,"iq","set"),s.describe="subscribe, unavailable: roster",i.describe="set: roster"),null!==t&&t.apply(this,arguments)},e.connect=function(s,i,r,o,a,c){t=r,"undefined"==typeof s&&(s=null),"undefined"==typeof i&&(i=null),r=n,_connect.apply(e,[s,i,r,o,a,c])},e.attach=function(s,i,r,o,a,c,h){t=o,"undefined"==typeof s&&(s=null),"undefined"==typeof i&&(i=null),"undefined"==typeof r&&(r=null),o=n,_attach.apply(e,[s,i,r,o,a,c,h])},Strophe.addNamespace("ROSTER_VER","urn:xmpp:features:rosterver"),Strophe.addNamespace("NICK","http://jabber.org/protocol/nick"),msos.console.debug(this._p_name+"init -> done!")},supportVersioning:function(){return this._connection.features&&this._connection.features.getElementsByTagName("ver").length>0},get:function(e,t,n){var s,i={xmlns:Strophe.NS.ROSTER};return msos.console.debug(this._p_name+"get -> called."),this.items=[],this.supportVersioning()&&(i.ver=t||"",this.items=n||[]),s=$iq({type:"get",id:this._connection.getUniqueId("roster")}).c("query",i),this._connection.sendIQ(s,"get: query roster",this._onReceiveRosterSuccess.bind(this,e),this._onReceiveRosterError.bind(this,e),!1,Strophe.NS.ROSTER)},registerCallback:function(e){msos.console.debug(this._p_name+"registerCallback -> called."),this._callbacks.push(e)},registerRequestCallback:function(e){msos.console.debug(this._p_name+"registerRequestCallback -> called."),this._callbacks_request.push(e)},findItem:function(e){var t=0;for(msos.console.debug(this._p_name+"findItem -> called, jid: "+e),t=0;t<this.items.length;t+=1)if(this.items[t]&&this.items[t].jid==e)return this.items[t];return!1},removeItem:function(e){var t=0;for(msos.console.debug(this._p_name+"removeItem -> called, jid: "+e),t=0;t<this.items.length;t+=1)if(this.items[t]&&this.items[t].jid==e)return this.items.splice(t,1),!0;return!1},subscribe:function(e,t,n){var s=$pres({to:e,type:"subscribe"});t&&""!==t&&s.c("status").t(t).up(),n&&""!==n&&s.c("nick",{xmlns:Strophe.NS.NICK}).t(n).up(),this._connection.send(s)},unsubscribe:function(e,t){var n=$pres({to:e,type:"unsubscribe"});t&&""!==t&&n.c("status").t(t),this._connection.send(n)},authorize:function(e,t){var n=$pres({to:e,type:"subscribed"});t&&""!==t&&n.c("status").t(t),this._connection.send(n)},unauthorize:function(e,t){var n=$pres({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),this._connection.send(n)},add:function(e,t,n,s){var i=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:e,name:t}),r=0;for(r=0;r<n.length;r+=1)i.c("group").t(n[r]).up();this._connection.sendIQ(i,"set: query roster, item jid/name",s,s,!1,Strophe.NS.ROSTER)},update:function(e,t,n,s){var i,r,o,a=this.findItem(e),c=0;if(!a)throw"item not found";for(i=t||a.name,r=n||a.groups,o=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:a.jid,name:i}),c=0;c<r.length;c+=1)o.c("group").t(r[c]).up();return this._connection.sendIQ(o,"set: query roster, item jid/name",s,s,!1,Strophe.NS.ROSTER)},remove:function(e,t){var n,s=this.findItem(e);if(!s)throw"item not found";n=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:s.jid,subscription:"remove"}),this._connection.sendIQ(n,"set: query roster, item remove",t,t,!1,Strophe.NS.ROSTER)},_onReceiveRosterSuccess:function(e,t){this._updateItems(t),e(this.items)},_onReceiveRosterError:function(e,t){e(this.items)},_onReceivePresence:function(e){var t=e.getAttribute("from"),n=Strophe.getBareJidFromJid(t),s=this.findItem(n),i=e.getAttribute("type");if(!s)return"subscribe"===i&&this._call_backs_request(n),!0;if("unavailable"==i)delete s.resources[Strophe.getResourceFromJid(t)];else{if(i)return!0;s.resources[Strophe.getResourceFromJid(t)]={show:0!==e.getElementsByTagName("show").length?Strophe.getText(e.getElementsByTagName("show")[0]):"",status:0!==e.getElementsByTagName("status").length?Strophe.getText(e.getElementsByTagName("status")[0]):"",priority:0!==e.getElementsByTagName("priority").length?Strophe.getText(e.getElementsByTagName("priority")[0]):""}}return this._call_backs(this.items,s),!0},_call_backs_request:function(e){var t=0;for(t=0;t<this._callbacks_request.length;t+=1)this._callbacks_request[t](e)},_call_backs:function(e,t){var n=0;for(n=0;n<this._callbacks.length;n+=1)this._callbacks[n](e,t)},_onReceiveIQ:function(e){var t,n=e.getAttribute("id"),s=e.getAttribute("from");if(s&&""!==s&&s!=this._connection.jid&&s!=Strophe.getBareJidFromJid(this._connection.jid))return!0;var t=$iq({type:"result",id:n,from:this._connection.jid});return this._connection.send(t),this._updateItems(e),!0},_updateItems:function(e){var t=e.getElementsByTagName("query"),n=this;0!==t.length&&(this.ver=t.item(0).getAttribute("ver"),jQuery(t.item(0)).children("item").each(function(e,t){n._updateItem(t)})),this._call_backs(this.items)},_updateItem:function(e){var t=e.getAttribute("jid"),n=e.getAttribute("name"),s=e.getAttribute("subscription"),i=e.getAttribute("ask"),r=[];return jQuery(e).children("group").each(function(e,t){r.push(Strophe.getText(t))}),"remove"==s?void this.removeItem(t):(e=this.findItem(t),void(e?(e.name=n,e.subscription=s,e.ask=i,e.groups=r):this.items.push({name:n,jid:t,subscription:s,ask:i,groups:r,resources:{}})))}});