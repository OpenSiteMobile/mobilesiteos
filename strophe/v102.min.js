(function(_1){"use strict";var _2,_3="Strophe.Builder - ",_4="Strophe.Connection - ",_5="Strophe.Handler - ",_6="Strophe.Request - ";function _7(_8,_9){return new _2.Builder(_8,_9);};function _a(_b){return new _2.Builder("message",_b);};function _c(_d){return new _2.Builder("iq",_d);};function _e(_f){return new _2.Builder("presence",_f);};_2={VERSION:"1.0.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{"a":["href"],"blockquote":["style"],"br":[],"cite":["style"],"em":[],"img":["src","alt","style","height","width"],"li":["style"],"ol":["style"],"p":["style"],"span":["style"],"strong":[],"ul":["style"],"body":[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(tag){var i=0;for(i=0;i<_2.XHTML.tags.length;i+=1){if(tag===_2.XHTML.tags[i]){return true;}}return false;},validAttribute:function(tag,_10){var i=0;if(_2.XHTML.attributes[tag]!==undefined&&_2.XHTML.attributes[tag].length>0){for(i=0;i<_2.XHTML.attributes[tag].length;i+=1){if(_10===_2.XHTML.attributes[tag][i]){return true;}}}return false;},validCSS:function(_11){var i=0;for(i=0;i<_2.XHTML.css.length;i+=1){if(_11===_2.XHTML.css[i]){return true;}}return false;}},addNamespace:function(_12,_13){_2.NS[_12]=_13;},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},status_name:["ERROR","CONNECTING","CONNFAIL","AUTHENTICATING","AUTHFAIL","CONNECTED","DISCONNECTED","DISCONNECTING","ATTACHED"],ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(_14,_15){var i,_16;for(i=0;i<_14.childNodes.length;i+=1){_16=_14.childNodes[i];if(_16.nodeType===_2.ElementType.NORMAL){_15(_16);}}},_xmlGenerator:null,xmlGenerator:function(){if(!_2._xmlGenerator){var doc=document.implementation.createDocument("jabber:client","strophe",null);_2._xmlGenerator=doc;}return _2._xmlGenerator;},xmlElement:function(_17){if(!_17){return null;}var _18=_2.xmlGenerator().createElement(_17),a=0,i=0,k="";for(a=1;a<arguments.length;a+=1){if(!msos.var_is_empty(arguments[a])){if(typeof arguments[a]==="string"||typeof arguments[a]==="number"){_18.appendChild(_2.xmlTextNode(arguments[a]));}else{if(typeof arguments[a]==="object"&&typeof arguments[a].sort==="function"){for(i=0;i<arguments[a].length;i+=1){if(typeof arguments[a][i]==="object"&&typeof arguments[a][i].sort==="function"){_18.setAttribute(arguments[a][i][0],arguments[a][i][1]);}}}else{if(typeof arguments[a]==="object"){for(k in arguments[a]){_18.setAttribute(k,arguments[a][k]);}}}}}}return _18;},xmlescape:function(_19){if(msos.var_is_empty(_19)){msos.console.warn("Strophe.xmlescape -> missing input!");return "";}_19=_19.replace(/\&/g,"&amp;");_19=_19.replace(/</g,"&lt;");_19=_19.replace(/>/g,"&gt;");_19=_19.replace(/'/g,"&apos;");_19=_19.replace(/"/g,"&quot;");return _19;},xmlTextNode:function(_1a){return _2.xmlGenerator().createTextNode(_1a);},xmlHtmlNode:function(_1b){var doc=null,dbg="",_1c;if(window.DOMParser){dbg="DOMParser";_1c=new DOMParser();doc=_1c.parseFromString("<body xmlns:stream='foo' >"+_1b+"</body>","text/xml").documentElement.firstChild;}else{if(window.ActiveXObject){dbg="ActiveXObject";doc=new ActiveXObject("MSXML2.DOMDocument");doc.async=false;doc.preserveWhiteSpace=true;doc.loadXML(_1b);}else{msos.console.error("Strophe.xmlHtmlNode -> error: parser na!");}}if(msos.config.query.domparse){msos.console.debug("Strophe.xmlHtmlNode -> via: "+dbg+", from: "+_1b);}return doc;},getText:function(_1d){if(!_1d){return null;}var str="",i=0;if(_1d.childNodes.length===0&&_1d.nodeType===_2.ElementType.TEXT){str+=_1d.nodeValue;}for(i=0;i<_1d.childNodes.length;i+=1){if(_1d.childNodes[i].nodeType===_2.ElementType.TEXT){str+=_1d.childNodes[i].nodeValue;}}return _2.xmlescape(str);},copyElement:function(_1e){var i=0,el;if(_1e.nodeType===_2.ElementType.NORMAL){el=_2.xmlElement(_1e.tagName);for(i=0;i<_1e.attributes.length;i+=1){el.setAttribute(_1e.attributes[i].nodeName.toLowerCase(),_1e.attributes[i].value);}for(i=0;i<_1e.childNodes.length;i+=1){el.appendChild(_2.copyElement(_1e.childNodes[i]));}}else{if(_1e.nodeType===_2.ElementType.TEXT){el=_2.xmlGenerator().createTextNode(_1e.nodeValue);}}return el;},createHtml:function(_1f){var i=0,el,j=0,tag,_20,_21,css,_22,_23,_24,_25;msos.console.debug("Strophe.createHtml -> called.");if(_1f.nodeType===_2.ElementType.NORMAL){tag=_1f.nodeName.toLowerCase();if(_2.XHTML.validTag(tag)){try{el=_2.xmlElement(tag);for(i=0;i<_2.XHTML.attributes[tag].length;i+=1){_20=_2.XHTML.attributes[tag][i];_21=_1f.getAttribute(_20);if(!msos.var_is_empty(_21)&&_21!==false&&_21!==0){if(_20==="style"&&typeof _21==="object"){if(_21.cssText!==undefined){_21=_21.cssText;}}if(_20==="style"){css=[];_22=_21.split(";");for(j=0;j<_22.length;j+=1){_23=_22[j].split(":");_24=_23[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(_2.XHTML.validCSS(_24)){_25=_23[1].replace(/^\s*/,"").replace(/\s*$/,"");css.push(_24+": "+_25);}}if(css.length>0){_21=css.join("; ");el.setAttribute(_20,_21);}}else{el.setAttribute(_20,_21);}}}for(i=0;i<_1f.childNodes.length;i+=1){el.appendChild(_2.createHtml(_1f.childNodes[i]));}}catch(e){el=_2.xmlTextNode("");msos.console.warn("Strophe - createHtml -> invalid elements in: "+tag+", error: "+e);}}else{el=_2.xmlGenerator().createDocumentFragment();for(i=0;i<_1f.childNodes.length;i+=1){el.appendChild(_2.createHtml(_1f.childNodes[i]));}}}else{if(_1f.nodeType===_2.ElementType.FRAGMENT){el=_2.xmlGenerator().createDocumentFragment();for(i=0;i<_1f.childNodes.length;i+=1){el.appendChild(_2.createHtml(_1f.childNodes[i]));}}else{if(_1f.nodeType===_2.ElementType.TEXT){el=_2.xmlTextNode(_1f.nodeValue);}}}return el;},escapeNode:function(_26){if(msos.var_is_empty(_26)){msos.console.warn("Strophe.escapeNode -> missing input!");return "";}return _26.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40");},unescapeNode:function(_27){if(msos.var_is_empty(_27)){msos.console.warn("Strophe.unescapeNode -> missing input!");return "";}return _27.replace(/\\20/g," ").replace(/\\22/g,"\"").replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\");},getNodeFromJid:function(jid){var out=null;if(jid.indexOf("@")<0){msos.console.debug("Strophe.getNodeFromJid -> called, node: null");return out;}out=jid.split("@")[0];if(msos.config.verbose){msos.console.debug("Strophe.getNodeFromJid -> called, node: "+out);}return out;},getDomainFromJid:function(jid){var _28=_2.getBareJidFromJid(jid),_29=[],out;if(_28.indexOf("@")<0){msos.console.debug("Strophe.getDomainFromJid -> called, domain: "+_28);return _28;}_29=_28.split("@");_29.splice(0,1);out=_29.join("@");if(msos.config.verbose){msos.console.debug("Strophe.getDomainFromJid -> called, domain: "+out);}return out;},getResourceFromJid:function(jid){var s=jid.split("/"),out=null;if(s.length<2){msos.console.debug("Strophe.getResourceFromJid -> called, resource: null");return out;}s.splice(0,1);out=s.join("/");if(msos.config.verbose){msos.console.debug("Strophe.getResourceFromJid -> called, resource: "+out);}return out;},getBareJidFromJid:function(jid){var out=jid?jid.split("/")[0]:null;msos.console.debug("Strophe.getBareJidFromJid -> called, bare: "+out);return out;},serialize:function(_2a){var _2b,_2c,i,_2d;if(msos.config.query.serialize){msos.console.debug("Strophe.serialize -> start.");}if(msos.var_is_empty(_2a)){msos.console.warn("Strophe.serialize -> done, no elem!");return null;}if(typeof _2a.tree==="function"){_2a=_2a.tree();}_2b=_2a.nodeName;if(_2a.getAttribute("_realname")){_2b=_2a.getAttribute("_realname");}_2c="<"+_2b;for(i=0;i<_2a.attributes.length;i+=1){if(_2a.attributes[i].nodeName!=="_realname"){_2c+=" "+_2a.attributes[i].nodeName.toLowerCase()+"='"+_2a.attributes[i].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'";}}if(_2a.childNodes.length>0){_2c+=">";for(i=0;i<_2a.childNodes.length;i+=1){_2d=_2a.childNodes[i];switch(_2d.nodeType){case _2.ElementType.NORMAL:_2c+=_2.serialize(_2d);break;case _2.ElementType.TEXT:_2c+=_2.xmlescape(_2d.nodeValue);break;case _2.ElementType.CDATA:_2c+="<![CDATA["+_2d.nodeValue+"]]>";break;}}_2c+="</"+_2b+">";}else{_2c+="/>";}if(msos.config.query.serialize){msos.console.debug("Strophe.serialize -> done, output: "+_2c);}return _2c;},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(_2e,_2f){_2._connectionPlugins[_2e]=_2f;}};_2.Builder=function(_30,_31){if(_30==="presence"||_30==="message"||_30==="iq"){if(_31&&!_31.xmlns){_31.xmlns=_2.NS.CLIENT;}else{if(!_31){_31={xmlns:_2.NS.CLIENT};}}}this.nodeTree=_2.xmlElement(_30,_31);this.node=this.nodeTree;};_2.Builder.prototype={tree:function(){return this.nodeTree;},toString:function(){return _2.serialize(this.nodeTree);},up:function(){this.node=this.node.parentNode;return this;},attrs:function(_32){var k="";for(k in _32){this.node.setAttribute(k,_32[k]);}return this;},c:function(_33,_34,_35){var _36=_2.xmlElement(_33,_34,_35);this.node.appendChild(_36);if(!_35){this.node=_36;}return this;},cnode:function(_37){var _38=_2.xmlGenerator(),_39=false,_3a;try{_39=(_38.importNode!==undefined);}catch(e){_39=false;msos.console.warn(_3+"cnode -> error: "+e);}_3a=_39?_38.importNode(_37,true):_2.copyElement(_37);this.node.appendChild(_3a);this.node=_3a;return this;},t:function(_3b){var _3c=_2.xmlTextNode(_3b);this.node.appendChild(_3c);return this;},h:function(_3d){var _3e=document.createElement("body"),_3f;_3e.innerHTML=_3d;_3f=_2.createHtml(_3e);while(_3f.childNodes.length>0){this.node.appendChild(_3f.childNodes[0]);}return this;}};_2.Handler=function(_40,ns,_41,_42,id,_43,_44){this.handler=_40;this.ns=ns;this.name=_41;this.type=_42;this.id=id;this.options=_44||{matchBare:false};if(!this.options.matchBare){this.options.matchBare=false;}if(this.options.matchBare){this.from=_43?_2.getBareJidFromJid(_43):null;}else{this.from=_43;}this.user=true;};_2.Handler.prototype={isMatch:function(_45){var _46,_47=null,_48=this;if(this.options.matchBare){_47=_2.getBareJidFromJid(_45.getAttribute("from"));}else{_47=_45.getAttribute("from");}_46=false;if(!this.ns){_46=true;}else{_2.forEachChild(_45,function(_49){if(_49.getAttribute("xmlns")===_48.ns){_46=true;}});_46=_46||_45.getAttribute("xmlns")===this.ns;}if(_46&&(!this.name||_45.tagName.toLowerCase()===this.name.toLowerCase())&&(!this.type||_45.getAttribute("type")===this.type)&&(!this.id||_45.getAttribute("id")===this.id)&&(!this.from||_47===this.from)){return true;}return false;},run:function(_4a){var _4b=null;try{_4b=this.handler(_4a);}catch(e){if(e.sourceURL){msos.console.error(_5+"run -> error w/url: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message);}else{if(e.fileName){msos.console.error(_5+"run -> error w/file: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message);}else{if(e.stack){msos.console.error(_5+"run -> error w/stack: "+e.message+"\n"+e.stack);}else{msos.console.error(_5+"run -> error plain: "+e);}}}}return _4b;},toString:function(){return "{ Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+") }";}};_2.Handler=function(_4c,ns,_4d,_4e,id,_4f,_50){this.handler=_4c;this.ns=ns;this.name=_4d;this.type=_4e;this.id=id;this.options=_50||{matchBare:false};if(!this.options.matchBare){this.options.matchBare=false;}if(this.options.matchBare){this.from=_4f?_2.getBareJidFromJid(_4f):null;}else{this.from=_4f;}this.user=true;};_2.Handler.prototype={isMatch:function(_51){var _52,_53=null,_54=this;if(this.options.matchBare){_53=_2.getBareJidFromJid(_51.getAttribute("from"));}else{_53=_51.getAttribute("from");}_52=false;if(!this.ns){_52=true;}else{_2.forEachChild(_51,function(_55){if(_55.getAttribute("xmlns")===_54.ns){_52=true;}});_52=_52||_51.getAttribute("xmlns")===this.ns;}if(_52&&(!this.name||_51.tagName.toLowerCase()===this.name.toLowerCase())&&(!this.type||_51.getAttribute("type")===this.type)&&(!this.id||_51.getAttribute("id")===this.id)&&(!this.from||_53===this.from)){return true;}return false;},run:function(_56){var _57=null;try{_57=this.handler(_56);}catch(e){if(e.sourceURL){msos.console.error(_5+"run -> error w/url: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message);}else{if(e.fileName){msos.console.error(_5+"run -> error w/file: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message);}else{if(e.stack){msos.console.error(_5+"run -> error w/stack: "+e.message+"\n"+e.stack);}else{msos.console.error(_5+"run -> error plain: "+e);}}}}return _57;},toString:function(){return "{ Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+") }";}};_2.TimedHandler=function(_58,_59){this.period=_58;this.handler=_59;this.lastCalled=new Date().getTime();this.user=true;};_2.TimedHandler.prototype={run:function(){this.lastCalled=new Date().getTime();return this.handler();},reset:function(){this.lastCalled=new Date().getTime();},toString:function(){return "{ TimedHandler: "+this.handler+"("+this.period+") }";}};_2.Request=function(_5a,_5b,rid,_5c){_2._requestId+=1;this.id=_2._requestId;this.xmlData=_5a;this.data=_2.serialize(_5a);this.origFunc=_5b;this.func=_5b;this.rid=rid;this.date=NaN;this.sends=_5c||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date){return 0;}var now=new Date();return (now-this.date)/1000;};this.timeDead=function(){if(!this.dead){return 0;}var now=new Date();return (now-this.dead)/1000;};this.xhr=this._new_com_req();};_2.Request.prototype={getResponse:function(){var _5d=null,gr="getResponse -> ",dbg="no response.";if(msos.config.verbose){msos.console.debug(_6+gr+"start.");}if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){_5d=this.xhr.responseXML.documentElement;dbg="via responseXML.";}else{if(this.xhr.responseText){_5d=_2.xmlHtmlNode(this.xhr.responseText);dbg="via responseText.";}}if(_5d&&_5d.tagName==="parsererror"){msos.console.error(_6+gr+"parse error: "+this.xhr.responseText);return null;}if(msos.config.verbose){msos.console.debug(_6+gr+"done, "+dbg);}return _5d;},_new_com_req:function(){var xhr=null;if(window.XMLHttpRequest){xhr=new XMLHttpRequest();if(xhr.overrideMimeType){xhr.overrideMimeType("text/xml");}}else{if(window.ActiveXObject){xhr=new ActiveXObject("Microsoft.XMLHTTP");}}xhr.onreadystatechange=_.bind(this.func,null,this);return xhr;}};_2.Connection=function(_5e){this.service=_5e;this.jid="";this.domain=null;this.features=null;this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.resource=null;this._sasl_data=[];this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._idleTimeout=null;this._disconnectTimeout=null;this._authentication={};this.do_authentication=true;this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this.ws=null;this.connect_timeout=300;this._keep_alive_timer=20000;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*10000);this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this.maxRetries=5;this._idleTimeout=setTimeout(_.bind(this._onIdle,this),100);var k="",_5f,F;for(k in _2._connectionPlugins){_5f=_2._connectionPlugins[k];F=function(){};F.prototype=_5f;this[k]=new F();this[k].init(this);}};_2.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.ws=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._authentication={};this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*10000);},pause:function(){this.paused=true;},resume:function(){this.paused=false;},getUniqueId:function(_60){this._uniqueId+=1;if(typeof _60==="string"||typeof _60==="number"){return this._uniqueId+":"+_60;}return String(this._uniqueId);},xmlInput:function(_61){return;},xmlOutput:function(_62){return;},rawInput:function(_63){return;},rawOutput:function(_64){return;},mechanisms:{},_changeConnectStatus:function(_65,_66){var k="",_67,_68="failed.";msos.console.debug(_4+"_changeConnectStatus -> start, for: "+_2.status_name[_65]+" ("+_65+")");for(k in _2._connectionPlugins){_67=this[k];if(_67.statusChanged){_67.statusChanged(_65,_66);}}if(typeof this.connect_callback==="function"){this.connect_callback(_65,_66);_68="with callback function.";}else{_68="wwithout callback function.";}msos.console.debug(_4+"_changeConnectStatus -> done, "+(_66?_66+" ":"")+_68);},connect:function(jid,_69,_6a){msos.console.debug(_4+"connect -> start, jid: "+jid);this.jid=jid;this.authzid=_2.getBareJidFromJid(this.jid);this.authcid=_2.getNodeFromJid(this.jid);this.pass=_69;this.servtype="xmpp";this.connect_callback=_6a;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.domain=_2.getDomainFromJid(this.jid);this.resource=_2.getResourceFromJid(this.jid);this._changeConnectStatus(_2.Status.CONNECTING,null);var _6b=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":_2.NS.BOSH});this._requests.push(new _2.Request(_6b.tree(),_.bind(this._onRequestStateChange,this,_.bind(this._connect_cb,this)),_6b.tree().getAttribute("rid")));this._throttledRequestHandler();msos.console.debug(_4+"connect -> done, jid: "+jid);},_connect_cb:function(_6c){var _6d,typ,_6e,_6f,_70,_71,_72,_73,_74,_75=[],i=0,_76,_77,_78=false,_79;msos.console.debug(_4+"_connect_cb -> start.");if(!_6c){msos.console.warn(_4+"_connect_cb -> done, failed for no stanza.");return;}this.xmlInput(_6c);this.rawInput(_2.serialize(_6c));_6d=this._check_streamerror(_6c,_2.Status.CONNFAIL);if(_6d){msos.console.warn(_4+"_connect_cb -> done, failed.");return;}typ=_6c.getAttribute("type");if(typ!==null&&typ==="terminate"){_6e=_6c.getAttribute("condition");_6f=_6c.getElementsByTagName("conflict");if(_6e!==null){if(_6e==="remote-stream-error"&&_6f.length>0){_6e="conflict";}this._changeConnectStatus(_2.Status.CONNFAIL,_6e);}else{this._changeConnectStatus(_2.Status.CONNFAIL,"unknown");}msos.console.error(_4+"_connect_cb -> done, processing failed.");return;}this.connected=true;if(!this.sid){this.sid=_6c.getAttribute("sid");}_70=_6c.getAttribute("requests");if(_70){this.window=parseInt(_70,10);}_71=_6c.getAttribute("hold");if(_71){this.hold=parseInt(_71,10);}_72=_6c.getAttribute("wait");if(_72){this.wait=parseInt(_72,10);}this._authentication.legacy_auth=false;_73=_6c.getElementsByTagName("stream:features").length>0;if(!_73){_73=_6c.getElementsByTagName("features").length>0;}_74=_6c.getElementsByTagName("mechanism");if(_73&&_74.length>0){for(i=0;i<_74.length;i+=1){_76=_2.getText(_74[i]);if(this.mechanisms[_76]){_75.push(this.mechanisms[_76]);}}this._authentication.legacy_auth=_6c.getElementsByTagName("auth").length>0;_78=this._authentication.legacy_auth||_75.length>0;}else{if(msos.config.verbose){msos.console.warn(_4+"_connect_cb -> no features/auth. mechanisms.");}}if(!_78){_79=this._buildBody();this._requests.push(new _2.Request(_79.tree(),_.bind(this._onRequestStateChange,this,_.bind(this._connect_cb,this)),_79.tree().getAttribute("rid")));this._throttledRequestHandler();msos.console.debug(_4+"_connect_cb -> done, waiting for: stream:features");return;}if(this.do_authentication!==false){this.authenticate(_75);}msos.console.debug(_4+"_connect_cb -> done!");},send:function(_7a){var i=0;msos.console.debug(_4+"send -> start.");if(msos.var_is_null(_7a)){msos.console.error(_4+"send -> done, missing input!");return;}if(typeof _7a.sort==="function"){for(i=0;i<_7a.length;i+=1){this._queueData(_7a[i]);}}else{if(typeof _7a.tree==="function"){this._queueData(_7a.tree());}else{this._queueData(_7a);}}this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(_.bind(this._onIdle,this),100);msos.console.debug(_4+"send -> done!");},_doDisconnect:function(){msos.console.debug(_4+"_doDisconnect -> start.");this.authenticated=false;this.disconnecting=false;this.sid=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(_2.Status.DISCONNECTED,null);this.connected=false;}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];msos.console.debug(_4+"_doDisconnect -> done!");},_onDisconnectTimeout:function(){var req;msos.console.debug(_4+"_onDisconnectTimeout -> start.");while(this._requests.length>0){req=this._requests.pop();req.abort=true;req.xhr.abort();req.xhr.onreadystatechange=null;}this._doDisconnect();msos.console.debug(_4+"_onDisconnectTimeout -> done!");return false;},_sendTerminate:function(){msos.console.debug(_4+"_sendTerminate -> start.");var _7b=this._buildBody().attrs({type:"terminate"}),req;if(this.authenticated){_7b.c("presence",{xmlns:_2.NS.CLIENT,type:"unavailable"});}this.disconnecting=true;req=new _2.Request(_7b.tree(),_.bind(this._onRequestStateChange,this,_.bind(this._dataRecv,this)),_7b.tree().getAttribute("rid"));this._requests.push(req);this._throttledRequestHandler();msos.console.debug(_4+"_sendTerminate -> done!");},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(_.bind(this._onIdle,this),100);},_buildBody:function(){this.rid+=1;var _7c=_7("body",{rid:this.rid,xmlns:_2.NS.HTTPBIND});if(this.sid!==null){_7c.attrs({sid:this.sid});}return _7c;},_removeRequest:function(req){msos.console.debug(_4+"_removeRequest -> start.");var i;for(i=this._requests.length-1;i>=0;i-=1){if(req===this._requests[i]){this._requests.splice(i,1);}}req.xhr.onreadystatechange=null;this._throttledRequestHandler();msos.console.debug(_4+"_removeRequest -> done!");},_restartRequest:function(i){var req=this._requests[i];if(req.dead===null){req.dead=new Date();}this._processRequest(i);},_processRequest:function(i){var _7d="_processRequest -> ",req=this._requests[i],_7e=-1;msos.console.debug(_4+_7d+"start.");if(req.xhr.readyState===4){_7e=req.xhr.status;msos.console.debug(_4+_7d+"reqStatus: "+_7e);}if(_7e===undefined){_7e=-1;}if(req.sends>this.maxRetries){this._onDisconnectTimeout();msos.console.warn(_4+_7d+"timed out after "+i+" tries, reqStatus: "+_7e);return;}var _7f=req.age(),_80=(!isNaN(_7f)&&_7f>Math.floor(_2.TIMEOUT*this.wait)),_81=(req.dead!==null&&req.timeDead()>Math.floor(_2.SECONDARY_TIMEOUT*this.wait)),_82=(req.xhr.readyState===4&&(_7e<1||_7e>=500)),_83,_84;if(_80||_81||_82){if(_81){msos.console.error(_4+_7d+"request "+this._requests[i].id+" timed out (secondary), restarting");}req.abort=true;req.xhr.abort();req.xhr.onreadystatechange=null;this._requests[i]=new _2.Request(req.xmlData,req.origFunc,req.rid,req.sends);req=this._requests[i];}if(req.xhr.readyState===0){msos.console.debug(_4+_7d+"posting, id: "+req.id);try{req.xhr.open("POST",this.service,true);}catch(e2){msos.console.error(_4+_7d+"XHR open failed: "+e2);if(!this.connected){this._changeConnectStatus(_2.Status.CONNFAIL,"bad-service");}this.disconnect();return;}_83=function(){req.date=new Date();req.xhr.send(req.data);};if(req.sends>1){_84=Math.min(Math.floor(_2.TIMEOUT*this.wait),Math.pow(req.sends,3))*1000;setTimeout(_83,_84);}else{_83();}req.sends+=1;if(this.xmlOutput!==_2.Connection.prototype.xmlOutput){this.xmlOutput(req.xmlData);}if(this.rawOutput!==_2.Connection.prototype.rawOutput){this.rawOutput(req.data);}}else{msos.console.debug(_4+_7d+(i===0?"first":"second")+" request with readyState: "+req.xhr.readyState);}msos.console.debug(_4+_7d+"done!");},_throttledRequestHandler:function(){var trh="_throttledRequestHandler -> ";msos.console.debug(_4+trh+"start, queued request(s): "+this._requests.length);if(this._requests.length===0){msos.console.debug(_4+trh+"done, zero requests.");return;}if(this._requests.length>0){this._processRequest(0);}if(this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window){this._processRequest(1);}msos.console.debug(_4+trh+"done!");},_onRequestStateChange:function(_85,req){var ors="_onRequestStateChange -> ",_86=0,_87,_88,age,_89;if(msos.config.verbose){msos.console.debug(_4+ors+"start, id: "+req.id+", attempts: "+req.sends+" readyState: "+req.xhr.readyState);}if(req.abort){msos.console.warn(_4+ors+"request aborted, id: "+req.id);return;}if(req.xhr.readyState===4){_86=req.xhr.status||0;if(this.disconnecting){if(_86>=400){this._hitError(_86);msos.console.warn(_4+ors+"disconnecting with errors!");return;}}_87=(this._requests[0]===req);_88=(this._requests[1]===req);if((_86>0&&_86<500)){this._removeRequest(req);msos.console.debug(_4+ors+"id "+req.id+" remove for valid response, status: "+_86);}if(req.sends>5){this._removeRequest(req);msos.console.debug(_4+ors+"id "+req.id+" remove for to many attempts: "+req.sends);}if(_86===200){age=Math.floor(_2.SECONDARY_TIMEOUT*this.wait);if(_88||(_87&&this._requests.length>0&&this._requests[0].age()>age)){this._restartRequest(0);}msos.console.debug(_4+ors+"success, id: "+req.id+", attempts: "+req.sends);_89=req.getResponse();_85(_89);this.errors=0;}else{msos.console.warn(_4+ors+"id "+req.id+"."+req.sends+" has error(s), status: "+_86);if(_86===0||(_86>=400&&_86<600)||_86>=12000){this._hitError(_86);if(_86>=400&&_86<500){this._changeConnectStatus(_2.Status.DISCONNECTING,null);this._doDisconnect();}}}if(!((_86>0&&_86<500)||req.sends>5)){this._throttledRequestHandler();}}if(msos.config.verbose){msos.console.debug(_4+"_onRequestStateChange -> done!");}},_hitError:function(_8a){this.errors+=1;msos.console.warn(_4+"_hitError -> request errored, status: "+_8a+", number of errors: "+this.errors);if(this.errors>4){this._onDisconnectTimeout();}},_onIdle:function(){var i=0,_8b,_8c,_8d=[],now=new Date().getTime(),_8e,_8f;while(this.addTimeds.length>0){this.timedHandlers.push(this.addTimeds.pop());}while(this.removeTimeds.length>0){_8b=this.removeTimeds.pop();i=_.indexOf(this.timedHandlers,_8b);if(i>=0){this.timedHandlers.splice(i,1);}}for(i=0;i<this.timedHandlers.length;i+=1){_8b=this.timedHandlers[i];if(this.authenticated||!_8b.user){_8c=_8b.lastCalled+_8b.period;if(_8c-now<=0){if(_8b.run()){_8d.push(_8b);}}else{_8d.push(_8b);}}}this.timedHandlers=_8d;if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){msos.console.debug(_4+"_onIdle -> no requests, sending blank.");this._data.push(null);}if(this._requests.length<2&&this._data.length>0&&!this.paused){_8e=this._buildBody();for(i=0;i<this._data.length;i+=1){if(this._data[i]!==null){if(this._data[i]==="restart"){_8e.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":_2.NS.BOSH});}else{_8e.cnode(this._data[i]).up();}}}delete this._data;this._data=[];this._requests.push(new _2.Request(_8e.tree(),_.bind(this._onRequestStateChange,this,_.bind(this._dataRecv,this)),_8e.tree().getAttribute("rid")));this._processRequest(this._requests.length-1);}if(this._requests.length>0){_8f=this._requests[0].age();if(this._requests[0].dead!==null){if(this._requests[0].timeDead()>Math.floor(_2.SECONDARY_TIMEOUT*this.wait)){this._throttledRequestHandler();}}if(_8f>Math.floor(_2.TIMEOUT*this.wait)){msos.console.warn(_4+"_onIdle -> Request "+this._requests[0].id+" timed out, over "+Math.floor(_2.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler();}}clearTimeout(this._idleTimeout);if(this.connected){this._idleTimeout=setTimeout(_.bind(this._onIdle,this),100);}},_check_streamerror:function(_90,_91){var _92=_90.getElementsByTagName("stream:error")||[],_93,_94,_95;msos.console.debug(_4+"_check_streamerror -> start, status: "+_2.status_name[_91]);if(_92.length===0){msos.console.debug(_4+"_check_streamerror -> done, no errors!");return false;}_93=_92[0];_94=_93.childNodes[0].tagName;_95=_93.getElementsByTagName("text")[0].textContent;this._changeConnectStatus(_91,_94);this._doDisconnect();msos.console.debug(_4+"_check_streamerror -> done, condition: "+_94+" - "+_95);return true;},_dataRecv:function(_96){msos.console.debug(_4+"_dataRecv -> start.");var i=0,_97,typ,_98,_99,_9a=this;if(_96===null){msos.console.warn(_4+"_dataRecv -> done, no stanza");return;}if(this.xmlInput!==_2.Connection.prototype.xmlInput){this.xmlInput(_96);}if(this.rawInput!==_2.Connection.prototype.rawInput){this.rawInput(_2.serialize(_96));}while(this.removeHandlers.length>0){_97=this.removeHandlers.pop();i=_.indexOf(this.handlers,_97);if(i>=0){this.handlers.splice(i,1);}}while(this.addHandlers.length>0){this.handlers.push(this.addHandlers.pop());}if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect();msos.console.debug(_4+"_dataRecv -> done, graceful disconnect.");return;}typ=_96.getAttribute("type");if(typ!==null&&typ==="terminate"){if(this.disconnecting){msos.console.debug(_4+"_dataRecv -> done, too late to process.");return;}_98=_96.getAttribute("condition");_99=_96.getElementsByTagName("conflict");if(_98!==null){if(_98==="remote-stream-error"&&_99.length>0){_98="conflict";}this._changeConnectStatus(_2.Status.CONNFAIL,_98);}else{this._changeConnectStatus(_2.Status.CONNFAIL,"unknown");}this.disconnect();msos.console.warn(_4+"_dataRecv -> done, something went wrong.");return;}_2.forEachChild(_96,function(_9b){var i=0,_9c,_97;_9c=_9a.handlers;_9a.handlers=[];for(i=0;i<_9c.length;i+=1){_97=_9c[i];try{if(_97.isMatch(_9b)&&(_9a.authenticated||!_97.user)){if(_97.run(_9b)){_9a.handlers.push(_97);}}else{_9a.handlers.push(_97);}}catch(e){msos.console.warn(_4+"_dataRecv -> handler error: "+e);}}});msos.console.debug(_4+"_dataRecv -> done!");},_queueData:function(_9d){if(_9d===null||!_9d.tagName||!_9d.childNodes){throw {name:_4+"_queueData -> ",message:"Cannot queue non-DOMElement."};}this._data.push(_9d);if(msos.config.verbose){msos.console.debug(_4+"_queueData -> called, queued requests: "+this._data.length);}},_sasl_success_cb:function(_9e){var _9f,_a0,_a1=/([a-z]+)=([^,]+)(,|$)/,_a2=[];msos.console.debug(_4+"_sasl_success_cb -> start.");if(this._sasl_data["server-signature"]){_a0=Base64.decode(_2.getText(_9e));_a2=_a0.match(_a1);if(_a2[1]==="v"){_9f=_a2[2];}if(_9f!==this._sasl_data["server-signature"]){this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null;}this._sasl_data=[];msos.console.debug(_4+"_sasl_success_cb -> done, failed!");return this._sasl_failure_cb(null);}}msos.console.debug(_4+"_sasl_success_cb -> SASL authentication succeeded.");if(this._sasl_mechanism){this._sasl_mechanism.onSuccess();}this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null;}this._addSysHandler(_.bind(this._sasl_auth1_cb,this),null,"stream:features",null,null);this._sendRestart();msos.console.debug(_4+"_sasl_success_cb -> done!");return false;},authenticate:function(_a3){msos.console.debug(_4+"authenticate -> start, matched length: "+_a3.length);var i=0,j=0,_a4=false,_a5,_a6,_a7,_a8;for(i=0;i<_a3.length-1;i+=1){_a7=i;for(j=i+1;j<_a3.length;j+=1){if(_a3[j].priority>_a3[_a7].priority){_a7=j;}}if(_a7>j){_a8=_a3[i];_a3[i]=_a3[_a7];_a3[_a7]=_a8;}}for(i=0;i<_a3.length;i+=1){if(typeof _a3[i].test==="function"&&_a3[i].test(this)){this._sasl_success_handler=this._addSysHandler(_.bind(this._sasl_success_cb,this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(_.bind(this._sasl_failure_cb,this),null,"failure",null,null);this._sasl_challenge_handler=this._addSysHandler(_.bind(this._sasl_challenge_cb,this),null,"challenge",null,null);this._sasl_mechanism=new _a3[i]();this._sasl_mechanism.onStart(this);_a5=_7("auth",{xmlns:_2.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){_a6=this._sasl_mechanism.onChallenge(this,null);_a5.t(Base64.encode(_a6));}this.send(_a5.tree());_a4=true;msos.console.debug(_4+"authenticate -> mechanism found: "+this._sasl_mechanism.name);}}if(!_a4){if(_2.getNodeFromJid(this.jid)===null){this._changeConnectStatus(_2.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect();}else{this._changeConnectStatus(_2.Status.AUTHENTICATING,null);this._addSysHandler(_.bind(this._auth1_cb,this),null,null,null,"_auth_1");this.send(_c({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:_2.NS.AUTH}).c("username",{}).t(_2.getNodeFromJid(this.jid)).tree());}}msos.console.debug(_4+"authenticate -> done!");},disconnect:function(_a9){msos.console.debug(_4+"disconnect -> start, reason: "+_a9);this._changeConnectStatus(_2.Status.DISCONNECTING,_a9);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3000,_.bind(this._onDisconnectTimeout,this));this._sendTerminate();}msos.console.debug(_4+"disconnect -> done!");},sendIQ:function(_aa,_ab,_ac,_ad){var _ae=null,_af=this,id="",_b0;msos.console.debug(_4+"sendIQ -> start.");if(typeof _aa.tree==="function"){_aa=_aa.tree();}id=_aa.getAttribute("id")||"";if(!id){id=this.getUniqueId("sendIQ");_aa.setAttribute("id",id);}_b0=this.addHandler(function(_b1){if(_ae){_af.deleteTimedHandler(_ae);}var _b2=_b1.getAttribute("type");if(_b2==="result"){if(_ab){_ab(_b1);}}else{if(_b2==="error"){if(_ac){_ac(_b1);}}else{throw {name:_4+"sendIQ -> ",message:"Got bad IQ type: "+_b2};}}},null,"iq",null,id);if(_ad){_ae=this.addTimedHandler(_ad,function(){_af.deleteHandler(_b0);if(_ac){_ac(null);}return false;});}this.send(_aa);msos.console.debug(_4+"sendIQ -> done!");return id;},_sasl_challenge_cb:function(_b3){var _b4=Base64.decode(_2.getText(_b3)),_b5=this._sasl_mechanism.onChallenge(this,_b4);this.send(_7("response",{xmlns:_2.NS.SASL}).t(Base64.encode(_b5)).tree());return true;},_sasl_auth1_cb:function(_b6){var i=0,_b7,_b8;msos.console.debug(_4+"_sasl_auth1_cb -> start.");for(i=0;i<_b6.childNodes.length;i+=1){_b7=_b6.childNodes[i];if(_b7.nodeName==="bind"){this.do_bind=true;}if(_b7.nodeName==="session"){this.do_session=true;}}if(!this.do_bind){this._changeConnectStatus(_2.Status.AUTHFAIL,null);msos.console.debug(_4+"_sasl_auth1_cb -> done, AUTHFAIL");return false;}this._addSysHandler(_.bind(this._sasl_bind_cb,this),null,null,null,"_bind_auth_2");_b8=_2.getResourceFromJid(this.jid);if(_b8){this.send(_c({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:_2.NS.BIND}).c("resource",{}).t(_b8).tree());}else{this.send(_c({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:_2.NS.BIND}).tree());}msos.console.debug(_4+"_sasl_auth1_cb -> done!");return false;},_sasl_bind_cb:function(_b9){var _ba,_bb,_bc,sid,_bd,_be,_bf,_c0;msos.console.debug(_4+"_sasl_bind_cb -> start.");if(_b9.getAttribute("type")==="error"){_bf=_b9.getElementsByTagName("conflict");if(_bf.length>0){_c0="conflict";}this._changeConnectStatus(_2.Status.AUTHFAIL,_c0);msos.console.debug(_4+"_sasl_bind_cb -> done, SASL binding failed.");return false;}_ba=_b9.getElementsByTagName("bind");if(_ba.length>0){_bb=_ba[0].getElementsByTagName("jid");if(_bb.length>0){_bc=_2.getText(_bb[0]);sid=_2.getNodeFromJid(_bc);_bd=_2.getDomainFromJid(_bc);_be=_2.getResourceFromJid(_bc);if(sid===_be){_be=this.resource;this.jid=sid+"@"+_bd+"/"+_be;}else{this.jid=_bc;}if(this.do_session){this._addSysHandler(_.bind(this._sasl_session_cb,this),null,null,null,"_session_auth_2");this.send(_c({type:"set",id:"_session_auth_2"}).c("session",{xmlns:_2.NS.SESSION}).tree());}else{this.authenticated=true;this._changeConnectStatus(_2.Status.CONNECTED,null);}msos.console.debug(_4+"_sasl_bind_cb -> done, node count: "+_bb.length);return true;}}this._changeConnectStatus(_2.Status.AUTHFAIL,null);msos.console.warn(_4+"_sasl_bind_cb -> done, SASL binding failed.");return false;},_sasl_session_cb:function(_c1){msos.console.debug(_4+"_sasl_session_cb -> start.");if(_c1.getAttribute("type")==="result"){this.authenticated=true;this._changeConnectStatus(_2.Status.CONNECTED,null);}else{if(_c1.getAttribute("type")==="error"){msos.console.warn(_4+"_sasl_session_cb -> session creation failed.");this._changeConnectStatus(_2.Status.AUTHFAIL,null);return false;}}msos.console.debug(_4+"_sasl_session_cb -> done!");return false;},_sasl_failure_cb:function(_c2){msos.console.debug(_4+"_sasl_failure_cb -> start.");if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null;}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null;}if(this._sasl_mechanism){this._sasl_mechanism.onFailure();}this._changeConnectStatus(_2.Status.AUTHFAIL,null);msos.console.debug(_4+"_sasl_failure_cb -> done!");return false;},_auth1_cb:function(_c3){msos.console.debug(_4+"_auth1_cb -> start.");var iq=_c({type:"set",id:"_auth_2"}).c("query",{xmlns:_2.NS.AUTH}).c("username",{}).t(_2.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!_2.getResourceFromJid(this.jid)){this.jid=_2.getBareJidFromJid(this.jid)+"/strophe";}iq.up().c("resource",{}).t(_2.getResourceFromJid(this.jid));this._addSysHandler(_.bind(this._auth2_cb,this),null,null,null,"_auth_2");this.send(iq.tree());msos.console.debug(_4+"_auth1_cb -> done!");return false;},_auth2_cb:function(_c4){msos.console.debug(_4+"_auth2_cb -> start.");if(_c4.getAttribute("type")==="result"){this.authenticated=true;this._changeConnectStatus(_2.Status.CONNECTED,null);}else{if(_c4.getAttribute("type")==="error"){this._changeConnectStatus(_2.Status.AUTHFAIL,null);this.disconnect();}}msos.console.debug(_4+"_auth2_cb -> done!");return false;},addTimedHandler:function(_c5,_c6){var _c7=new _2.TimedHandler(_c5,_c6);this.addTimeds.push(_c7);return _c7;},deleteTimedHandler:function(_c8){this.removeTimeds.push(_c8);},addHandler:function(_c9,ns,_ca,_cb,id,_cc,_cd){var _ce=new _2.Handler(_c9,ns,_ca,_cb,id,_cc,_cd);this.addHandlers.push(_ce);return _ce;},deleteHandler:function(_cf){this.removeHandlers.push(_cf);},_addSysTimedHandler:function(_d0,_d1){var _d2=new _2.TimedHandler(_d0,_d1);_d2.user=false;this.addTimeds.push(_d2);return _d2;},_addSysHandler:function(_d3,ns,_d4,_d5,id){var _d6=new _2.Handler(_d3,ns,_d4,_d5,id);_d6.user=false;this.addHandlers.push(_d6);return _d6;}};_2.SASLMechanism=function(_d7,_d8,_d9){this.name=_d7;this.isClientFirst=_d8;this.priority=_d9;this._sasl_data=[];this.test=function(_da){return true;};this.onStart=function(_db){this._connection=_db;};this.onChallenge=function(_dc,_dd){throw new Error("You should implement challenge handling!");};this.onFailure=function(){this._connection=null;};this.onSuccess=function(){this._connection=null;};this._quote=function(str){if(msos.var_is_empty(str)){msos.console.warn("Strophe.SASLMechanism._quote -> missing input!");return "";}return "\""+str.replace(/\\/g,"\\\\").replace(/"/g,"\\\"")+"\"";};return this;};_1(_2,_7,_a,_c,_e);_2.SASLAnonymous=function(){};_2.SASLAnonymous.prototype=new _2.SASLMechanism("ANONYMOUS",false,10);_2.SASLAnonymous.test=function(_de){return _de.authcid===null;};_2.SASLPlain=function(){};_2.SASLPlain.prototype=new _2.SASLMechanism("PLAIN",true,20);_2.SASLPlain.test=function(_df){return _df.authcid!==null;};_2.SASLPlain.prototype.onChallenge=function(_e0,_e1){var _e2=_e0.authzid;_e2=_e2+"\x00";_e2=_e2+_e0.authcid;_e2=_e2+"\x00";_e2=_e2+_e0.pass;return _e2;};_2.SASLSHA1=function(){};_2.SASLSHA1.prototype=new _2.SASLMechanism("SCRAM-SHA-1",true,20);_2.SASLSHA1.test=function(_e3){return _e3.authcid!==null;};_2.SASLSHA1.prototype.onChallenge=function(_e4,_e5,_e6){var _e7=_e6||MD5.hexdigest(Math.random()*1234567890),_e8="n="+_e4.authcid+",r="+_e7;msos.console.debug("Strophe.SASLSHA1.onChallenge -> called.");this._sasl_data.cnonce=_e7;this._sasl_data["client-first-message-bare"]=_e8;_e8="n,,"+_e8;this.onChallenge=function(_e9,_ea){var _eb=[],_ec,_ed,_ee,Hi,U,_ef,_f0,_f1,_f2,_f3="c=biws,",_f4=this._sasl_data["client-first-message-bare"]+","+_ea+",",_e7=this._sasl_data.cnonce,_f5=/([a-z]+)=([^,]+)(,|$)/,i=0,k=0;while(_ea.match(_f5)){_eb=_ea.match(_f5);_ea=_ea.replace(_eb[0],"");switch(_eb[1]){case "r":_ec=_eb[2];break;case "s":_ed=_eb[2];break;case "i":_ee=_eb[2];break;}}if(!(_ec.substr(0,_e7.length)===_e7)){this._sasl_data=[];return _e9._sasl_failure_cb();}_f3+="r="+_ec;_f4+=_f3;_ed=Base64.decode(_ed);_ed+="";Hi=_ef=core_hmac_sha1(_e9.pass,_ed);for(i=1;i<_ee;i+=1){U=core_hmac_sha1(_e9.pass,binb2str(_ef));for(k=0;k<5;k+=1){Hi[k]^=U[k];}_ef=U;}Hi=binb2str(Hi);_f0=core_hmac_sha1(Hi,"Client Key");_f1=str_hmac_sha1(Hi,"Server Key");_f2=core_hmac_sha1(str_sha1(binb2str(_f0)),_f4);_e9._sasl_data["server-signature"]=b64_hmac_sha1(_f1,_f4);for(k=0;k<5;k+=1){_f0[k]^=_f2[k];}_f3+=",p="+Base64.encode(binb2str(_f0));return _f3;};_.bind(this.onChallenge,this);return _e8;};_2.SASLMD5=function(){};_2.SASLMD5.prototype=new _2.SASLMechanism("DIGEST-MD5",false,20);_2.SASLMD5.test=function(_f6){return _f6.authcid!==null;};_2.SASLMD5.prototype.onChallenge=function(_f7,_f8,_f9){var _fa=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,_fb=_f9||MD5.hexdigest(String(Math.random()*1234567890)),_fc="",_fd=null,_fe="",qop="",_ff,_100,A1,A2,_101="";msos.console.debug("Strophe.SASLMD5.onChallenge -> called.");while(_f8.match(_fa)){_ff=_f8.match(_fa);_f8=_f8.replace(_ff[0],"");_ff[2]=_ff[2].replace(/^"(.+)"$/,"$1");switch(_ff[1]){case "realm":_fc=_ff[2];break;case "nonce":_fe=_ff[2];break;case "qop":qop=_ff[2];break;case "host":_fd=_ff[2];break;}}_100=_f7.servtype+"/"+_f7.domain;if(_fd!==null){_100=_100+"/"+_fd;}A1=MD5.hash(_f7.authcid+":"+_fc+":"+this._connection.pass)+":"+_fe+":"+_fb;A2="AUTHENTICATE:"+_100;_101+="charset=utf-8,";_101+="username="+this._quote(_f7.authcid)+",";_101+="realm="+this._quote(_fc)+",";_101+="nonce="+this._quote(_fe)+",";_101+="nc=00000001,";_101+="cnonce="+this._quote(_fb)+",";_101+="digest-uri="+this._quote(_100)+",";_101+="response="+MD5.hexdigest(MD5.hexdigest(A1)+":"+_fe+":00000001:"+_fb+":auth:"+MD5.hexdigest(A2))+",";_101+="qop=auth";this.onChallenge=_.bind(function(_102,_103){return "";},this);return _101;};}(function(){"use strict";var args=Array.prototype.slice.call(arguments);window.Strophe=args[0];window.$build=args[1];window.$msg=args[2];window.$iq=args[3];window.$pres=args[4];}));