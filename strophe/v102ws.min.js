(function(_1){"use strict";var _2,_3="Strophe.Builder - ",_4="Strophe.Connection - ",_5="Strophe.Handler - ";function _6(_7,_8){return new _2.Builder(_7,_8);};function _9(_a){return new _2.Builder("message",_a);};function _b(_c){return new _2.Builder("iq",_c);};function _d(_e){return new _2.Builder("presence",_e);};_2={VERSION:"1.0.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{"a":["href"],"blockquote":["style"],"br":[],"cite":["style"],"em":[],"img":["src","alt","style","height","width"],"li":["style"],"ol":["style"],"p":["style"],"span":["style"],"strong":[],"ul":["style"],"body":[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(_f){var i=0;for(i=0;i<_2.XHTML.tags.length;i+=1){if(_f===_2.XHTML.tags[i]){return true;}}return false;},validAttribute:function(tag,_10){var i=0;if(_2.XHTML.attributes[tag]!==undefined&&_2.XHTML.attributes[tag].length>0){for(i=0;i<_2.XHTML.attributes[tag].length;i+=1){if(_10===_2.XHTML.attributes[tag][i]){return true;}}}return false;},validCSS:function(_11){var i=0;for(i=0;i<_2.XHTML.css.length;i+=1){if(_11===_2.XHTML.css[i]){return true;}}return false;}},addNamespace:function(_12,_13){_2.NS[_12]=_13;},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},status_name:["ERROR","CONNECTING","CONNFAIL","AUTHENTICATING","AUTHFAIL","CONNECTED","DISCONNECTED","DISCONNECTING","ATTACHED"],ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(_14,_15){var i,_16;for(i=0;i<_14.childNodes.length;i+=1){_16=_14.childNodes[i];if(_16.nodeType===_2.ElementType.NORMAL){_15(_16);}}},_xmlGenerator:null,xmlGenerator:function(){if(!_2._xmlGenerator){var doc=document.implementation.createDocument("jabber:client","strophe",null);_2._xmlGenerator=doc;}return _2._xmlGenerator;},xmlElement:function(_17){if(!_17){return null;}var _18=_2.xmlGenerator().createElement(_17),a=0,i=0,k="";for(a=1;a<arguments.length;a+=1){if(!msos.var_is_empty(arguments[a])){if(typeof arguments[a]==="string"||typeof arguments[a]==="number"){_18.appendChild(_2.xmlTextNode(arguments[a]));}else{if(typeof arguments[a]==="object"&&typeof arguments[a].sort==="function"){for(i=0;i<arguments[a].length;i+=1){if(typeof arguments[a][i]==="object"&&typeof arguments[a][i].sort==="function"){_18.setAttribute(arguments[a][i][0],arguments[a][i][1]);}}}else{if(typeof arguments[a]==="object"){for(k in arguments[a]){_18.setAttribute(k,arguments[a][k]);}}}}}}return _18;},xmlescape:function(_19){if(msos.var_is_empty(_19)){msos.console.warn("Strophe.xmlescape -> missing input!");return "";}_19=_19.replace(/\&/g,"&amp;");_19=_19.replace(/</g,"&lt;");_19=_19.replace(/>/g,"&gt;");_19=_19.replace(/'/g,"&apos;");_19=_19.replace(/"/g,"&quot;");return _19;},xmlTextNode:function(_1a){return _2.xmlGenerator().createTextNode(_1a);},xmlHtmlNode:function(_1b){var doc=null,dbg="",_1c;if(window.DOMParser){dbg="DOMParser";_1c=new DOMParser();doc=_1c.parseFromString("<body xmlns:stream='foo' >"+_1b+"</body>","text/xml").documentElement.firstChild;}else{if(window.ActiveXObject){dbg="ActiveXObject";doc=new ActiveXObject("MSXML2.DOMDocument");doc.async=false;doc.preserveWhiteSpace=true;doc.loadXML(_1b);}else{msos.console.error("Strophe.xmlHtmlNode -> error: parser na!");}}if(msos.config.query.domparse){msos.console.debug("Strophe.xmlHtmlNode -> via: "+dbg+", from: "+_1b);}return doc;},getText:function(_1d){if(!_1d){return null;}var str="",i=0;if(_1d.childNodes.length===0&&_1d.nodeType===_2.ElementType.TEXT){str+=_1d.nodeValue;}for(i=0;i<_1d.childNodes.length;i+=1){if(_1d.childNodes[i].nodeType===_2.ElementType.TEXT){str+=_1d.childNodes[i].nodeValue;}}return _2.xmlescape(str);},copyElement:function(_1e){var i=0,el;if(_1e.nodeType===_2.ElementType.NORMAL){el=_2.xmlElement(_1e.tagName);for(i=0;i<_1e.attributes.length;i+=1){el.setAttribute(_1e.attributes[i].nodeName.toLowerCase(),_1e.attributes[i].value);}for(i=0;i<_1e.childNodes.length;i+=1){el.appendChild(_2.copyElement(_1e.childNodes[i]));}}else{if(_1e.nodeType===_2.ElementType.TEXT){el=_2.xmlGenerator().createTextNode(_1e.nodeValue);}}return el;},createHtml:function(_1f){var i=0,el,j=0,tag,_20,_21,css,_22,_23,_24,_25;msos.console.debug("Strophe.createHtml -> called.");if(_1f.nodeType===_2.ElementType.NORMAL){tag=_1f.nodeName.toLowerCase();if(_2.XHTML.validTag(tag)){try{el=_2.xmlElement(tag);for(i=0;i<_2.XHTML.attributes[tag].length;i+=1){_20=_2.XHTML.attributes[tag][i];_21=_1f.getAttribute(_20);if(!msos.var_is_empty(_21)&&_21!==false&&_21!==0){if(_20==="style"&&typeof _21==="object"){if(_21.cssText!==undefined){_21=_21.cssText;}}if(_20==="style"){css=[];_22=_21.split(";");for(j=0;j<_22.length;j+=1){_23=_22[j].split(":");_24=_23[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(_2.XHTML.validCSS(_24)){_25=_23[1].replace(/^\s*/,"").replace(/\s*$/,"");css.push(_24+": "+_25);}}if(css.length>0){_21=css.join("; ");el.setAttribute(_20,_21);}}else{el.setAttribute(_20,_21);}}}for(i=0;i<_1f.childNodes.length;i+=1){el.appendChild(_2.createHtml(_1f.childNodes[i]));}}catch(e){el=_2.xmlTextNode("");msos.console.warn("Strophe - createHtml -> invalid elements in: "+tag+", error: "+e);}}else{el=_2.xmlGenerator().createDocumentFragment();for(i=0;i<_1f.childNodes.length;i+=1){el.appendChild(_2.createHtml(_1f.childNodes[i]));}}}else{if(_1f.nodeType===_2.ElementType.FRAGMENT){el=_2.xmlGenerator().createDocumentFragment();for(i=0;i<_1f.childNodes.length;i+=1){el.appendChild(_2.createHtml(_1f.childNodes[i]));}}else{if(_1f.nodeType===_2.ElementType.TEXT){el=_2.xmlTextNode(_1f.nodeValue);}}}return el;},escapeNode:function(_26){if(msos.var_is_empty(_26)){msos.console.warn("Strophe.escapeNode -> missing input!");return "";}return _26.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40");},unescapeNode:function(_27){if(msos.var_is_empty(_27)){msos.console.warn("Strophe.unescapeNode -> missing input!");return "";}return _27.replace(/\\20/g," ").replace(/\\22/g,"\"").replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\");},getNodeFromJid:function(jid){var out=null;if(jid.indexOf("@")<0){msos.console.debug("Strophe.getNodeFromJid -> called, node: null");return out;}out=jid.split("@")[0];if(msos.config.verbose){msos.console.debug("Strophe.getNodeFromJid -> called, node: "+out);}return out;},getDomainFromJid:function(jid){var _28=_2.getBareJidFromJid(jid),_29=[],out;if(_28.indexOf("@")<0){msos.console.debug("Strophe.getDomainFromJid -> called, domain: "+_28);return _28;}_29=_28.split("@");_29.splice(0,1);out=_29.join("@");if(msos.config.verbose){msos.console.debug("Strophe.getDomainFromJid -> called, domain: "+out);}return out;},getResourceFromJid:function(jid){var s=jid.split("/"),out=null;if(s.length<2){msos.console.debug("Strophe.getResourceFromJid -> called, resource: null");return out;}s.splice(0,1);out=s.join("/");if(msos.config.verbose){msos.console.debug("Strophe.getResourceFromJid -> called, resource: "+out);}return out;},getBareJidFromJid:function(jid){var out=jid?jid.split("/")[0]:null;msos.console.debug("Strophe.getBareJidFromJid -> called, bare: "+out);return out;},serialize:function(_2a){var _2b,_2c,i,_2d;if(msos.config.query.serialize){msos.console.debug("Strophe.serialize -> start.");}if(msos.var_is_empty(_2a)){msos.console.warn("Strophe.serialize -> done, no elem!");return null;}if(typeof _2a.tree==="function"){_2a=_2a.tree();}_2b=_2a.nodeName;if(_2a.getAttribute("_realname")){_2b=_2a.getAttribute("_realname");}_2c="<"+_2b;for(i=0;i<_2a.attributes.length;i+=1){if(_2a.attributes[i].nodeName!=="_realname"){_2c+=" "+_2a.attributes[i].nodeName.toLowerCase()+"='"+_2a.attributes[i].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'";}}if(_2a.childNodes.length>0){_2c+=">";for(i=0;i<_2a.childNodes.length;i+=1){_2d=_2a.childNodes[i];switch(_2d.nodeType){case _2.ElementType.NORMAL:_2c+=_2.serialize(_2d);break;case _2.ElementType.TEXT:_2c+=_2.xmlescape(_2d.nodeValue);break;case _2.ElementType.CDATA:_2c+="<![CDATA["+_2d.nodeValue+"]]>";break;}}_2c+="</"+_2b+">";}else{_2c+="/>";}if(msos.config.query.serialize){msos.console.debug("Strophe.serialize -> done, output: "+_2c);}return _2c;},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(_2e,_2f){_2._connectionPlugins[_2e]=_2f;}};_2.Builder=function(_30,_31){if(_30==="presence"||_30==="message"||_30==="iq"){if(_31&&!_31.xmlns){_31.xmlns=_2.NS.CLIENT;}else{if(!_31){_31={xmlns:_2.NS.CLIENT};}}}this.nodeTree=_2.xmlElement(_30,_31);this.node=this.nodeTree;};_2.Builder.prototype={tree:function(){return this.nodeTree;},toString:function(){return _2.serialize(this.nodeTree);},up:function(){this.node=this.node.parentNode;return this;},attrs:function(_32){var k="";for(k in _32){this.node.setAttribute(k,_32[k]);}return this;},c:function(_33,_34,_35){var _36=_2.xmlElement(_33,_34,_35);this.node.appendChild(_36);if(!_35){this.node=_36;}return this;},cnode:function(_37){var _38=_2.xmlGenerator(),_39=false,_3a;try{_39=(_38.importNode!==undefined);}catch(e){_39=false;msos.console.warn(_3+"cnode -> error: "+e);}_3a=_39?_38.importNode(_37,true):_2.copyElement(_37);this.node.appendChild(_3a);this.node=_3a;return this;},t:function(_3b){var _3c=_2.xmlTextNode(_3b);this.node.appendChild(_3c);return this;},h:function(_3d){var _3e=document.createElement("body"),_3f;_3e.innerHTML=_3d;_3f=_2.createHtml(_3e);while(_3f.childNodes.length>0){this.node.appendChild(_3f.childNodes[0]);}return this;}};_2.Handler=function(_40,ns,_41,_42,id,_43,_44){this.handler=_40;this.ns=ns;this.name=_41;this.type=_42;this.id=id;this.options=_44||{matchBare:false};if(!this.options.matchBare){this.options.matchBare=false;}if(this.options.matchBare){this.from=_43?_2.getBareJidFromJid(_43):null;}else{this.from=_43;}this.user=true;};_2.Handler.prototype={isMatch:function(_45){var _46,_47=null,_48=this;if(this.options.matchBare){_47=_2.getBareJidFromJid(_45.getAttribute("from"));}else{_47=_45.getAttribute("from");}_46=false;if(!this.ns){_46=true;}else{_2.forEachChild(_45,function(_49){if(_49.getAttribute("xmlns")===_48.ns){_46=true;}});_46=_46||_45.getAttribute("xmlns")===this.ns;}if(_46&&(!this.name||_45.tagName.toLowerCase()===this.name.toLowerCase())&&(!this.type||_45.getAttribute("type")===this.type)&&(!this.id||_45.getAttribute("id")===this.id)&&(!this.from||_47===this.from)){return true;}return false;},run:function(_4a){var _4b=null;try{_4b=this.handler(_4a);}catch(e){if(e.sourceURL){msos.console.error(_5+"run -> error w/url: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message);}else{if(e.fileName){msos.console.error(_5+"run -> error w/file: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message);}else{if(e.stack){msos.console.error(_5+"run -> error w/stack: "+e.message+"\n"+e.stack);}else{msos.console.error(_5+"run -> error plain: "+e);}}}}return _4b;},toString:function(){return "{ Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+") }";}};_2.Handler=function(_4c,ns,_4d,_4e,id,_4f,_50){this.handler=_4c;this.ns=ns;this.name=_4d;this.type=_4e;this.id=id;this.options=_50||{matchBare:false};if(!this.options.matchBare){this.options.matchBare=false;}if(this.options.matchBare){this.from=_4f?_2.getBareJidFromJid(_4f):null;}else{this.from=_4f;}this.user=true;};_2.Handler.prototype={isMatch:function(_51){var _52,_53=null,_54=this;if(this.options.matchBare){_53=_2.getBareJidFromJid(_51.getAttribute("from"));}else{_53=_51.getAttribute("from");}_52=false;if(!this.ns){_52=true;}else{_2.forEachChild(_51,function(_55){if(_55.getAttribute("xmlns")===_54.ns){_52=true;}});_52=_52||_51.getAttribute("xmlns")===this.ns;}if(_52&&(!this.name||_51.tagName.toLowerCase()===this.name.toLowerCase())&&(!this.type||_51.getAttribute("type")===this.type)&&(!this.id||_51.getAttribute("id")===this.id)&&(!this.from||_53===this.from)){return true;}return false;},run:function(_56){var _57=null;try{_57=this.handler(_56);}catch(e){if(e.sourceURL){msos.console.error(_5+"run -> error w/url: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message);}else{if(e.fileName){msos.console.error(_5+"run -> error w/file: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message);}else{if(e.stack){msos.console.error(_5+"run -> error w/stack: "+e.message+"\n"+e.stack);}else{msos.console.error(_5+"run -> error plain: "+e);}}}}return _57;},toString:function(){return "{ Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+") }";}};_2.TimedHandler=function(_58,_59){this.period=_58;this.handler=_59;this.lastCalled=new Date().getTime();this.user=true;};_2.TimedHandler.prototype={run:function(){this.lastCalled=new Date().getTime();return this.handler();},reset:function(){this.lastCalled=new Date().getTime();},toString:function(){return "{ TimedHandler: "+this.handler+"("+this.period+") }";}};_2.Connection=function(_5a){this.service=_5a;this.jid="";this.domain=null;this.features=null;this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.resource=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._idleTimeout=null;this._disconnectTimeout=null;this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this.ws=null;this.connect_timeout=300;this._keep_alive_timer=20000;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*10000);this._idleTimeout=setTimeout(_.bind(this._onIdle,this),100);var k="",_5b,F;for(k in _2._connectionPlugins){_5b=_2._connectionPlugins[k];F=function(){};F.prototype=_5b;this[k]=new F();this[k].init(this);}};_2.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*10000);},pause:function(){this.paused=true;},resume:function(){this.paused=false;},getUniqueId:function(_5c){this._uniqueId+=1;if(typeof _5c==="string"||typeof _5c==="number"){return this._uniqueId+":"+_5c;}return String(this._uniqueId);},xmlInput:function(_5d){return;},xmlOutput:function(_5e){return;},rawInput:function(_5f){return;},rawOutput:function(_60){return;},_changeConnectStatus:function(_61,_62){var k="",_63,_64="failed.";msos.console.debug(_4+"_changeConnectStatus -> start, for: "+_2.status_name[_61]+" ("+_61+")");for(k in _2._connectionPlugins){_63=this[k];if(_63.statusChanged){_63.statusChanged(_61,_62);}}if(typeof this.connect_callback==="function"){this.connect_callback(_61,_62);_64="with callback function.";}else{_64="wwithout callback function.";}msos.console.debug(_4+"_changeConnectStatus -> done, "+(_62?_62+" ":"")+_64);},connect:function(jid,_65,_66){msos.console.debug(_4+"connect -> start, jid: "+jid);this.jid=jid;this.authzid=_2.getBareJidFromJid(this.jid);this.authcid=_2.getNodeFromJid(this.jid);this.pass=_65;this.servtype="xmpp";this.connect_callback=_66;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.domain=_2.getDomainFromJid(this.jid);this.resource=_2.getResourceFromJid(this.jid);this._changeConnectStatus(_2.Status.CONNECTING,null);if(!this.ws){this.ws=new WebSocket(this.service,this.servtype);this.ws.onopen=_.bind(this._ws_on_open,this);this.ws.onerror=_.bind(this._ws_on_error,this);this.ws.onclose=_.bind(this._ws_on_close,this);this.ws.onmessage=_.bind(this._ws_on_message,this);}msos.console.debug(_4+"connect -> done, jid: "+jid);},attach:function(){return;},flush:function(){return;},send:function(_67){var i=0;msos.console.debug(_4+"send -> start.");if(msos.var_is_null(_67)){msos.console.error(_4+"send -> done, missing input!");return;}if(typeof _67.sort==="function"){for(i=0;i<_67.length;i+=1){this._queueData(_67[i]);}}else{if(typeof _67.tree==="function"){this._queueData(_67.tree());}else{this._queueData(_67);}}clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(_.bind(this._onIdle,this),100);msos.console.debug(_4+"send -> done!");},_doDisconnect:function(){msos.console.debug(_4+"_doDisconnect -> start.");this.authenticated=false;this.disconnecting=false;this.sid=null;this.streamId=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(_2.Status.DISCONNECTED,null);this.connected=false;}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];if(this.ws.readyState!==this.ws.CLOSED){this.ws.close();}this.ws=null;msos.console.debug(_4+"_doDisconnect -> done!");},_onDisconnectTimeout:function(){msos.console.debug(_4+"_onDisconnectTimeout -> start.");this._doDisconnect();msos.console.debug(_4+"_onDisconnectTimeout -> done!");return false;},_sendTerminate:function(){var _68;msos.console.debug(_4+"_sendTerminate -> start.");this.disconnecting=true;if(this.authenticated){_68=_d({xmlns:_2.NS.CLIENT,type:"unavailable"});this.ws.send(_68);}else{if(this.ws.readyState!==this.ws.CLOSED){this.ws.send("</stream:stream>");}}msos.console.debug(_4+"_sendTerminate -> done!");},_buildBody:function(_69){var _6a=_6("body",{rid:this.rid,xmlns:_2.NS.HTTPBIND});if(this.sid!==null){_6a.attrs({sid:this.sid});}return _6a.cnode(_69);},_ws_on_open:function(){var _6b,_6c;msos.console.debug(_4+"_ws_on_open -> start.");this.connected=true;this._addSysHandler(_.bind(this._session_cb,this),null,null,null,"_session_init");this.sid=Math.floor(Math.random()*4294967295);_6c=_2.getResourceFromJid(this.jid);if(_6c){this.send(_b({type:"set",id:"_session_init"}).c("bind",{xmlns:_2.NS.BIND}).c("resource",{}).t(_6c).tree());}else{this.send(_b({type:"set",id:"_session_init"}).c("bind",{xmlns:_2.NS.BIND}).tree());}this._addSysTimedHandler(this._keep_alive_timer,_.bind(this._keep_alive_handler,this));msos.console.debug(_4+"_ws_on_open -> done!");},_ws_on_message:function(_6d){var _6e=_6d.data,_6f,_70="";msos.console.debug(_4+"_ws_on_message -> start.");_6f=_2.xmlHtmlNode(_6e);if(this.disconnecting&&_6f.nodeName==="presence"&&_6f.getAttribute("type")==="unavailable"){_70="disconnecting, nodeName: "+_6f.nodeName;}else{_6f=this._buildBody(_6f).tree();_70="success, nodeName: "+_6f.nodeName;this._dataRecv(_6f);}msos.console.debug(_4+"_ws_on_message -> done, success!");},_ws_on_error:function(e){var msg=e.data||"missing or bad connection.";msos.console.error(_4+"_ws_on_error -> error: "+msg,e);},_ws_on_close:function(ev){msos.console.debug(_4+"_ws_on_close -> called.");this._doDisconnect();},_keep_alive_handler:function(){this.ws.send("\n");return true;},_session_cb:function(_71){var _72,_73,_74;msos.console.debug(_4+"_session_cb -> start.");if(_71.getAttribute("type")==="result"){_72=_71.getElementsByTagName("bind");if(_72.length>0){_73=_72[0].getElementsByTagName("jid");if(_73.length>0){_74=_2.getText(_73[0]);this.jid=this.sid+"@"+_2.getDomainFromJid(_74)+"/"+this.resource;}}else{this.jid=this.sid+"@"+this.domain+"/"+this.resource;}msos.console.debug(_4+"_session_cb -> authenticated for: "+this.jid);this.authenticated=true;this._changeConnectStatus(_2.Status.CONNECTED,null);}else{if(_71.getAttribute("type")==="error"){msos.console.warn(_4+"_session_cb -> session creation failed.");this._changeConnectStatus(_2.Status.AUTHFAIL,null);return false;}}msos.console.debug(_4+"_session_cb -> done!");return false;},_processRequest:function(_75){var _76="_processRequest -> ",_77="";msos.console.debug(_4+_76+"start.");this.rid+=1;_75.setAttribute("rid",this.rid);_75.setAttribute("sid",this.sid);_77=_2.serialize(_75);this.ws.send(_77);if(this.xmlOutput!==_2.Connection.prototype.xmlOutput){this.xmlOutput(_75);}if(this.rawOutput!==_2.Connection.prototype.rawOutput){this.rawOutput(_77);}msos.console.debug(_4+_76+"done!");},_onIdle:function(){var _78=this._data,i=0;if(_78.length>0&&!this.paused){for(i=0;i<_78.length;i+=1){if(_78[i]!==null){this._processRequest(_78[i]);}}this._data=[];}},_dataRecv:function(_79){msos.console.debug(_4+"_dataRecv -> start.");var i=0,_7a,typ,_7b,_7c,_7d=this;if(_79===null){msos.console.warn(_4+"_dataRecv -> done, no stanza");return;}if(this.xmlInput!==_2.Connection.prototype.xmlInput){this.xmlInput(_79);}if(this.rawInput!==_2.Connection.prototype.rawInput){this.rawInput(_2.serialize(_79));}while(this.removeHandlers.length>0){_7a=this.removeHandlers.pop();i=_.indexOf(this.handlers,_7a);if(i>=0){this.handlers.splice(i,1);}}while(this.addHandlers.length>0){this.handlers.push(this.addHandlers.pop());}if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect();msos.console.debug(_4+"_dataRecv -> done, graceful disconnect.");return;}typ=_79.getAttribute("type");if(typ!==null&&typ==="terminate"){if(this.disconnecting){msos.console.debug(_4+"_dataRecv -> done, too late to process.");return;}_7b=_79.getAttribute("condition");_7c=_79.getElementsByTagName("conflict");if(_7b!==null){if(_7b==="remote-stream-error"&&_7c.length>0){_7b="conflict";}this._changeConnectStatus(_2.Status.CONNFAIL,_7b);}else{this._changeConnectStatus(_2.Status.CONNFAIL,"unknown");}this.disconnect();msos.console.warn(_4+"_dataRecv -> done, something went wrong.");return;}_2.forEachChild(_79,function(_7e){var i=0,_7f,_7a;_7f=_7d.handlers;_7d.handlers=[];for(i=0;i<_7f.length;i+=1){_7a=_7f[i];try{if(_7a.isMatch(_7e)&&(_7d.authenticated||!_7a.user)){if(_7a.run(_7e)){_7d.handlers.push(_7a);}}else{_7d.handlers.push(_7a);}}catch(e){msos.console.warn(_4+"_dataRecv -> handler error: "+e);}}});msos.console.debug(_4+"_dataRecv -> done!");},_queueData:function(_80){if(_80===null||!_80.tagName||!_80.childNodes){throw {name:_4+"_queueData -> ",message:"Cannot queue non-DOMElement."};}this._data.push(_80);if(msos.config.verbose){msos.console.debug(_4+"_queueData -> called, queued requests: "+this._data.length);}},disconnect:function(_81){msos.console.debug(_4+"disconnect -> start, reason: "+_81);this._changeConnectStatus(_2.Status.DISCONNECTING,_81);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3000,_.bind(this._onDisconnectTimeout,this));this._sendTerminate();}msos.console.debug(_4+"disconnect -> done!");},sendIQ:function(_82,_83,_84,_85){var _86=null,_87=this,id="",_88;msos.console.debug(_4+"sendIQ -> start.");if(typeof _82.tree==="function"){_82=_82.tree();}id=_82.getAttribute("id")||"";if(!id){id=this.getUniqueId("sendIQ");_82.setAttribute("id",id);}_88=this.addHandler(function(_89){if(_86){_87.deleteTimedHandler(_86);}var _8a=_89.getAttribute("type");if(_8a==="result"){if(_83){_83(_89);}}else{if(_8a==="error"){if(_84){_84(_89);}}else{throw {name:_4+"sendIQ -> ",message:"Got bad IQ type: "+_8a};}}},null,"iq",null,id);if(_85){_86=this.addTimedHandler(_85,function(){_87.deleteHandler(_88);if(_84){_84(null);}return false;});}this.send(_82);msos.console.debug(_4+"sendIQ -> done!");return id;},addTimedHandler:function(_8b,_8c){var _8d=new _2.TimedHandler(_8b,_8c);this.addTimeds.push(_8d);return _8d;},deleteTimedHandler:function(_8e){this.removeTimeds.push(_8e);},addHandler:function(_8f,ns,_90,_91,id,_92,_93){var _94=new _2.Handler(_8f,ns,_90,_91,id,_92,_93);this.addHandlers.push(_94);return _94;},deleteHandler:function(_95){this.removeHandlers.push(_95);},_addSysTimedHandler:function(_96,_97){var _98=new _2.TimedHandler(_96,_97);_98.user=false;this.addTimeds.push(_98);return _98;},_addSysHandler:function(_99,ns,_9a,_9b,id){var _9c=new _2.Handler(_99,ns,_9a,_9b,id);_9c.user=false;this.addHandlers.push(_9c);return _9c;}};_1(_2,_6,_9,_b,_d);}(function(){"use strict";var _9d=Array.prototype.slice.call(arguments);window.Strophe=_9d[0];window.$build=_9d[1];window.$msg=_9d[2];window.$iq=_9d[3];window.$pres=_9d[4];}));